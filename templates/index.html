<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAI Talent Assessment</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom font import for a cleaner look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            color: #333;
            background: #f8f9fa;
        }



        .modal-container {
            transition: opacity 0.3s ease-out;
        }

        .modal-content-container, .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: scale(0.95);
            opacity: 0;
        }

        .modal-active .modal-content-container, .modal-active .modal-content {
            transform: scale(1);
            opacity: 1;
        }
       
        .feature-card {
            transition: transform 0.2s ease-in-out;
        }
       
        .feature-card:hover {
            transform: translateY(-8px);
        }
       
        .button-shadow {
            box-shadow: 0 4px 14px 0 rgba(255, 111, 0, 0.39);
        }

        /* --- Styles from checkpoint 01 --- */
        body.app-background {
            background: linear-gradient(135deg, #FF8C00 0%, #F5F5DC 50%, #8BC34A 100%);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
        }
       
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Keyframes for the image carousel fade effect */
        @keyframes fade {
            from { opacity: 0.4; }
            to { opacity: 1; }
        }

        .fade-in {
            animation-name: fade;
            animation-duration: 1.5s;
        }

        /* Custom styling for the test cards for a nicer visual */
        .test-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        /* --- Animations for the background elements --- */
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-20px) rotate(10deg); opacity: 1; }
            100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
        }

        .bg-element {
            position: absolute;
            animation: float 10s infinite ease-in-out;
            z-index: 0;
            opacity: 0.8;
        }
       
        /* Specific animations for each element to add variety */
        .bg-element-1 { top: 10%; left: 5%; animation-duration: 12s; }
        .bg-element-2 { top: 50%; right: 10%; animation-duration: 14s; animation-delay: 2s; }
        .bg-element-3 { bottom: 20%; left: 25%; animation-duration: 10s; animation-delay: 4s; }
        .bg-element-4 { top: 30%; left: 40%; animation-duration: 13s; animation-delay: 1s; }
        .bg-element-5 { bottom: 5%; right: 20%; animation-duration: 11s; animation-delay: 3s; }
        .bg-element-6 { top: 80%; left: 70%; animation-duration: 15s; animation-delay: 5s; }
       
        /* Full screen modal for test details */
        .test-detail-modal-container {
            transition: opacity 0.3s ease-out;
        }
        .test-detail-modal-container .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: scale(0.95);
            opacity: 0;
        }
        .test-detail-modal-container.modal-active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        /* Leaderboard Styles */
        #main-leaderboard-body tr:hover {
            background-color: #f9fafb; /* light hover */
            transition: background-color 0.2s ease-in-out;
        }

        #main-leaderboard-body td {
            vertical-align: top;
            line-height: 1.4;
        }

        .leaderboard-rank {
            font-weight: 700;
            color: #FF6F00; /* orange highlight for rank */
        }

        .leaderboard-highlight {
            background: linear-gradient(90deg, #22ff00, #FF6F00);
            font-weight: 700;
        }

        /* Spinner for AI feedback */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #f39c12;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

     
        .gradient-text {
            background: linear-gradient(45deg, #f3ec78, #af4261);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Styling for the new streak switch/slider */
        #streak-slider-container {
            background-color: #e5e7eb; /* bg-gray-200 */
            padding: 0.25rem; /* p-1 */
            border-radius: 9999px; /* rounded-full */
            display: inline-flex;
            align-items: center;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }

        .streak-slider-btn {
            padding: 0.5rem 0.6rem; /* py-2 px-4 */
            border-radius: 9999px; /* rounded-full */
            font-weight: 500; /* font-medium */
            font-size: 0.75rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            white-space: nowrap;
        }

        .streak-slider-btn.active {
            background-color: #ffffff; /* bg-white */
            color: #ea580c; /* text-orange-600 */
            font-weight: 600; /* font-semibold */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced styles for streak day circles */
        .streak-day {
            transition: all 0.3s ease;
        }
        .streak-day.active {
            background: linear-gradient(135deg, #f97316, #fb923c);
            color: white;
            box-shadow: 0 4px 10px rgba(251, 146, 60, 0.4);
            transform: scale(1.05);
        }
       
        .graph-filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            transition: background-color 0.2s, color 0.2s;
        }
        .graph-filter-btn.active {
            background-color: #fb923c;
            color: white;
        }

    /* --- Chatbot Styles --- */
    #chat-fab {
        transition: transform 0.3s ease-in-out;
    }
    #chat-fab:hover {
        transform: scale(1.1);
    }

    #chat-container {
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        transform: translateY(20px) scale(0.95);
        opacity: 0;
        pointer-events: none;
    }
    #chat-container.active {
        transform: translateY(0) scale(1);
        opacity: 1;
        pointer-events: auto;
    }

    .user-message {
        background-color: #ea580c; /* orange-600 */
        color: white;
    }
    .bot-message {
        background-color: #e5e7eb; /* gray-200 */
        color: #1f2937; /* gray-800 */
    }

    @keyframes typing {
        0% { content: '.'; }
        33% { content: '..'; }
        66% { content: '...'; }
        100% { content: '.'; }
    }

    .typing-indicator::after {
        content: '.';
        animation: typing 1.5s infinite;
    }

/* --- Training Goals Styles --- */
.goal-item.completed .goal-text {
    text-decoration: line-through;
    color: #9ca3af; /* text-gray-400 */
}

/* Style for the checkbox */
.goal-checkbox {
    transform: scale(1.2);
    accent-color: #f97316; /* orange-500 */
}

/* Styles for the view toggle buttons */
.goal-toggle-btn {
    padding: 0.5rem 1rem;
    border-radius: 0.375rem; /* rounded-md */
    font-weight: 500;
    font-size: 0.875rem;
    color: #4b5563; /* text-gray-600 */
    background-color: transparent;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}
.goal-toggle-btn.active {
    background-color: #ffffff;
    color: #ea580c; /* text-orange-600 */
    font-weight: 600;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
}

/* Styles for the new date selector buttons */
.date-selector-btn {
    padding: 0.5rem 1rem;
    border-radius: 9999px; /* rounded-full */
    font-weight: 500;
    font-size: 0.875rem;
    color: #4b5563; /* text-gray-600 */
    background-color: #e5e7eb; /* bg-gray-200 */
    border: none;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    white-space: nowrap;
    flex-shrink: 0;
    text-align: center;
}
.date-selector-btn.active {
    background-color: #ea580c; /* bg-orange-600 */
    color: #ffffff; /* text-white */
    font-weight: 600;
    box-shadow: 0 4px 14px 0 rgba(234, 88, 12, 0.39);
}
/* Hide scrollbar for the date container */
#date-buttons-container::-webkit-scrollbar {
    display: none;
}
#date-buttons-container {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

/* --- Video Recording Styles --- */
.recording-indicator {
    animation: blink 1.5s infinite;
}
@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}



    </style>
</head>
<body class="bg-gray-50 text-gray-800 overflow-x-hidden">

    <!-- Landing Page Content -->
    <div id="landing-page-content">
     <!-- Landing Page Navbar -->
<header class="fixed top-0 w-full z-50 bg-white shadow-lg">
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
   
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round"
           stroke-linejoin="round" class="text-green-600">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
      <span class="text-xl font-bold text-orange-600">SAI Sports Analyzer</span>
    </div>

    <!-- Desktop Nav Links -->
    <div class="hidden md:flex space-x-8">
      <a href="#features" class="relative text-gray-700 font-medium hover:text-orange-600 group">
        Features
        <span class="absolute left-0 -bottom-1 w-0 h-[2px] bg-orange-600 group-hover:w-full transition-all duration-300"></span>
      </a>
      <a href="#testimonials" class="relative text-gray-700 font-medium hover:text-orange-600 group">
        Testimonials
        <span class="absolute left-0 -bottom-1 w-0 h-[2px] bg-orange-600 group-hover:w-full transition-all duration-300"></span>
      </a>
      <a href="#leaderboard" class="relative text-gray-700 font-medium hover:text-orange-600 group">
        Leaderboard
        <span class="absolute left-0 -bottom-1 w-0 h-[2px] bg-orange-600 group-hover:w-full transition-all duration-300"></span>
      </a>
    </div>

    <!-- CTA Button -->
   <a href="/login" id="login-btn" class="hidden sm:inline-block bg-orange-600 text-white px-5 py-2 rounded-full font-medium hover:bg-orange-700 hover:scale-105 active:scale-95 transition-transform duration-200">
  Login
</a>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="md:hidden text-gray-700 hover:text-orange-600 focus:outline-none">
      <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg">
    <div class="px-4 pt-4 pb-6 space-y-4">
      <a href="#features" class="block text-gray-700 font-medium hover:text-orange-600">Features</a>
      <a href="#testimonials" class="block text-gray-700 font-medium hover:text-orange-600">Testimonials</a>
      <a href="#leaderboard" class="block text-gray-700 font-medium hover:text-orange-600">Leaderboard</a>
      <button class="w-full bg-orange-600 text-white py-2 rounded-lg font-medium hover:bg-orange-700 transition duration-300">
        Login
      </button>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  menuBtn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
  });
</script>


        <main class="container mx-auto px-4 py-8 space-y-16">
            <!-- Hero Section -->
            <section class="flex flex-col md:flex-row items-center justify-center text-center md:text-left py-16">
                <div class="md:w-1/2 space-y-6 md:pr-12">
                    <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight text-gray-900 drop-shadow-sm">
    Unlock Athletic Potential with Data-Driven Insights
</h1>
<p class="text-lg text-gray-600 max-w-lg mx-auto md:mx-0 leading-relaxed">
    SAI Sports Analyzer uses cutting-edge video analysis to provide objective, measurable performance data for athletes and coaches.
</p>
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 justify-center md:justify-start">
                     <button id="hero-cta-button" class="bg-orange-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-orange-700 hover:scale-105 active:scale-95 transition-transform duration-200 button-shadow">
    Start Now
</button>
<button class="bg-white text-gray-800 font-semibold py-3 px-8 rounded-full border border-gray-300 hover:bg-gray-100 hover:scale-105 active:scale-95 transition-transform duration-200">
    Learn More
</button>
                    </div>
                </div>
                <div class="md:w-1/2 mt-12 md:mt-0">
<img src="img.jpg" alt="Athlete sprinting on a track" class="w-full h-auto rounded-xl shadow-2xl">
            </section>

            <!-- Our Features Section -->
            <section id="features">
                <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 mb-10">Why Choose SAI?</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="feature-card bg-white p-8 rounded-2xl shadow-2xl text-center space-y-4">
                        <div class="w-20 h-20 mx-auto bg-orange-100 rounded-full flex items-center justify-center text-orange-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
</svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">Objective Analysis</h3>
                        <p class="text-gray-600">Eliminate guesswork with precise metrics and data on speed, power, and agility.</p>
                    </div>
                    <div class="feature-card bg-white p-8 rounded-2xl shadow-2xl text-center space-y-4">
                        <div class="w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center text-green-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 18l-5-5h10M11 6l5 5H6"></path>
</svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">Performance Tracking</h3>
                        <p class="text-gray-600">Track athlete progress over time and identify areas for improvement.</p>
                    </div>
                    <div class="feature-card bg-white p-8 rounded-2xl shadow-2xl text-center space-y-4">
                        <div class="w-20 h-20 mx-auto bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21a9 9 0 100-18 9 9 0 000 18zM12 8v8M8 12h8"></path>
</svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">Leaderboards & Rankings</h3>
                        <p class="text-gray-600">Compare results against local, state, and national athletes for a competitive edge.</p>
                    </div>
                </div>
            </section>

            <!-- Testimonials Section -->
            <section id="testimonials" class="bg-gray-100 p-12 rounded-xl shadow-inner">
                <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 mb-10">What Our Users Say</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                   <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-orange-500">
                        <p class="text-gray-700 italic mb-4">"SAI Sports Analyzer has revolutionized how we evaluate players. The objective data helps us make smarter decisions for player development."</p>
                        <p class="font-semibold text-gray-900">- Coach Ravi Kumar, Elite Sports Academy</p>
                    </div>
                   <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-green-500">
                        <p class="text-gray-700 italic mb-4">"I've always wondered how I compare to other athletes. The SAI platform gave me clear, verifiable data and showed me exactly where I need to improve."</p>
                        <p class="font-semibold text-gray-900">- Athlete Neha Sharma, National Track Team</p>
                    </div>
                </div>
            </section>

           <!-- Final Call to Action Section -->
          <section class="bg-[linear-gradient(45deg,#FF9933_0%,#FFFFFF_40%,#FFFFFF_40%,#FFFFFF_60%,#ffff_60%,#138808_100%)] text-white p-12 rounded-xl text-center shadow-xl">
               <h2 class="text-3xl sm:text-4xl font-bold mb-4 text-gray-900">Ready to Unleash Your Potential?</h2>
<p class="text-lg max-w-2xl mx-auto mb-6 text-gray-800">Join the future of sports talent assessment. Request a demo to see how SAI can transform your team's performance.</p>
           <button id="final-cta-button" class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-blue-800 transition duration-300">
    Start Now
</button>
            </section>
        </main>
        <!-- Simple footer -->
        <footer class="text-center py-6 text-gray-500 text-sm">
            &copy; 2024 Sports Authority of India. All rights reserved.
        </footer>
    </div>

    <!-- App Page Content (hidden by default) -->
    <div id="app-page-content" class="hidden">
        <!-- Animated Background Elements -->
        <div id="animated-background" class="absolute inset-0 overflow-hidden -z-10">
            <!-- SVG for a running shoe -->
            <div class="bg-element bg-element-1 w-16 h-16 sm:w-20 sm:h-20 text-orange-400">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <path d="M16 18H6a4 4 0 0 1-4-4V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2zM4 14h12M12 2v2M12 18v2M18 10h4M18 14h4M8 18v2M8 2v2M2 10v4M2 10h4"/>
                </svg>
            </div>
            <!-- SVG for a soccer ball -->
            <div class="bg-element bg-element-2 w-16 h-16 sm:w-20 sm:h-20 text-green-500">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <circle cx="12" cy="12" r="10"></circle><path d="M12 2a10 10 0 0 1 8.66 5A10 10 0 0 1 12 22a10 10 0 0 1-8.66-15A10 10 0 0 1 12 2z"></path>
                </svg>
            </div>
            <!-- SVG for a medal -->
            <div class="bg-element bg-element-3 w-16 h-16 sm:w-20 sm:h-20 text-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path><path d="M12 20a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path>
                </svg>
            </div>
            <!-- More background elements for variety -->
            <div class="bg-element bg-element-4 w-12 h-12 sm:w-16 sm:h-16 text-orange-400 opacity-60">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <path d="M16 18H6a4 4 0 0 1-4-4V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2zM4 14h12M12 2v2M12 18v2M18 10h4M18 14h4M8 18v2M8 2v2M2 10v4M2 10h4"/>
                </svg>
            </div>
            <div class="bg-element bg-element-5 w-12 h-12 sm:w-16 sm:h-16 text-green-500 opacity-60">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <circle cx="12" cy="12" r="10"></circle><path d="M12 2a10 10 0 0 1 8.66 5A10 10 0 0 1 12 22a10 10 0 0 1-8.66-15A10 10 0 0 1 12 2z"></path>
                </svg>
            </div>
            <div class="bg-element bg-element-6 w-12 h-12 sm:w-16 sm:h-16 text-blue-500 opacity-60">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full">
                    <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path><path d="M12 20a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path>
                </svg>
            </div>
        </div>
       
        <!-- Top Navigation Bar for App Page -->
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <button id="back-to-landing-btn" class="text-gray-600 hover:text-orange-600 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                    </button>
                    <div class="flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                        <span class="text-xl font-bold text-orange-600">SAI Sports Analyzer</span>
                    </div>
                </div>
               
                <div class="flex items-center space-x-6">
                    <a href="#" class="hidden sm:inline-block text-gray-600 hover:text-orange-600 font-medium transition duration-300">About us</a>
                    <a href="#" class="hidden sm:inline-block text-gray-600 hover:text-orange-600 font-medium transition duration-300">Connect with coaches</a>
                    <a href="#" class="hidden sm:inline-block text-gray-600 hover:text-orange-600 font-medium transition duration-300">Community</a>
                    <a href="#" class="hidden sm:inline-block text-gray-600 hover:text-orange-600 font-medium transition duration-300">How to use</a>
                    <button id="profile-menu-button-app" class="text-gray-600 hover:text-orange-600 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-8">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                </div>
            </nav>
        </header>

        <main id="main-content" class="container mx-auto px-4 py-8 space-y-12 relative z-10">
           
            <!-- Daily Streaks Section (Updated) -->
            <section>
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 flex items-center mb-4 sm:mb-0">
                        🔥 Daily Streak
                    </h2>
                    <div id="streak-slider-container">
                        <!-- Slider buttons will be populated by JavaScript -->
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
                    <div class="flex items-center space-x-2">
                        <p class="text-lg font-semibold text-gray-800">Your current streak for this test: </p>
                        <p id="current-streak-count" class="text-2xl font-bold text-orange-600">0 Days</p>
                    </div>
                    <div id="daily-streaks-container" class="flex items-center justify-center space-x-2 sm:space-x-4">
                        <!-- Streaks will be dynamically inserted here -->
                    </div>
                </div>
            </section>
           
            <!-- Performance Analysis Section -->
            <section>
                 <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                     <h2 class="text-2xl font-bold text-gray-900 mb-4">Check Your Overall Athletic Profile</h2>
                     <p class="text-gray-600 mb-6 max-w-2xl mx-auto">See how your key fitness parameters stack up against national benchmarks in a comprehensive performance analysis.</p>
                     <button id="analyze-performance-btn" class="bg-orange-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-orange-700 hover:scale-105 active:scale-95 transition-transform duration-200 button-shadow">
                         Analyze My Performance
                     </button>
                 </div>
             </section>
           
                        <!-- My Training Goals Section -->
            <section id="training-goals">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">My Training Goals</h2>
                    <!-- View Toggle Buttons -->
                    <div id="goals-view-toggle" class="mt-3 sm:mt-0 flex items-center bg-gray-200 rounded-lg p-1">
                        <button class="goal-toggle-btn active" data-view="daily">Daily Goals</button>
                        <button class="goal-toggle-btn" data-view="overall">Overall Goals</button>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <!-- Horizontal Date Selector (for Daily Goals view) -->
                    <div id="daily-goals-date-selector" class="mb-4">
                        <div id="date-buttons-container" class="flex items-center space-x-2 overflow-x-auto pb-2">
                            <!-- Date buttons will be populated by JS -->
                        </div>
                        <input type="date" id="goal-custom-date-input" class="w-full sm:w-auto px-4 py-2 mt-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 transition hidden">
                    </div>

                    <!-- Input for new goal -->
                    <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2 mb-4">
                        <input type="text" id="goal-input" placeholder="Enter a new goal..." class="flex-1 w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 transition">
                        <button id="add-goal-btn" class="w-full sm:w-auto bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-orange-700 active:scale-95 transition-transform duration-200 button-shadow">
                            Add
                        </button>
                    </div>
                    <!-- Daily Reminder Area -->
                    <div id="goals-reminder-container" class="mb-4"></div>
                    <!-- List of goals -->
                    <div id="goals-list-container" class="space-y-3">
                        <!-- Goals will be dynamically inserted here -->
                    </div>
                    <!-- Clear Completed Button (Appears when there are completed tasks) -->
                    <div id="clear-completed-container" class="text-right mt-4"></div>
                </div>
            </section>



            <!-- Fitness Assignment Test Section -->
            <section>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Fitness Assignment test</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Sit Ups Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer" data-test-name="Sit Ups">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="3"></circle><path d="M6.5 8.5a5 5 0 008 5.5l1.5-1.5a6 6 0 00-8-5.5"></path><path d="M12 12v9"></path><path d="M9 21h6"></path></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Sit Ups</h3>
                        <p class="text-sm text-gray-500">Evaluate your core strength and abdominal endurance.</p>
                    </div>

                    <!-- Push Ups Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer" data-test-name="Push Ups">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-500 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 14a9 9 0 1 1-18 0"></path><path d="M12 22V10"></path><path d="m5 10 7-7 7 7"></path></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Push Ups</h3>
                        <p class="text-sm text-gray-500">Assess your upper body strength and endurance.</p>
                    </div>
                   
                    <!-- Vertical Height Jump Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer" data-test-name="Vertical Height Jump">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-orange-500 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3L5 21"/><path d="M19 3L19 21"/><path d="M12 13L12 5"/><path d="M9 8L12 5L15 8"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Vertical Height Jump</h3>
                        <p class="text-sm text-gray-500">Measure your explosive leg power and jumping height.</p>
                    </div>

                    <!-- Sit and Reach Test Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer" data-test-name="Sit and Reach">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-purple-500 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22h20"/><path d="M7 22V12l5-2h3l5 4v6"/><circle cx="12" cy="7" r="2"/><path d="M15 10h5"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Sit and Reach Test</h3>
                        <p class="text-sm text-gray-500">Test the flexibility of your lower back and hamstring muscles.</p>
                    </div>
                </div>
            </section>

            <!-- Game-specific Fitness Tests Section -->
            <section>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Game-specific Fitness Tests</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                    <!-- Football Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer game-icon-btn" data-sport-name="football">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a10 10 0 00-7.53 16.59"></path><path d="M12 2a10 10 0 017.53 16.59"></path></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Football</h3>
                        <p class="text-sm text-gray-500">Tests for agility, speed, and endurance on the field.</p>
                    </div>
                    <!-- Cricket Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer game-icon-btn" data-sport-name="cricket">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22l-4-4 1.5-1.5L15 19l6-6-3-3-2.5 2.5"/><path d="M15.5 6.5l-3-3L15 1l3 3-2.5 2.5z"/><circle cx="5" cy="19" r="2"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Cricket</h3>
                        <p class="text-sm text-gray-500">Assessments for batting power, bowling speed, and fielding agility.</p>
                    </div>
                    <!-- Hockey Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer game-icon-btn" data-sport-name="hockey">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-orange-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.3 22H19a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-1"/><path d="M18 7V2"/><path d="M4 14h10c.6 0 1-.4 1-1V5c0-.6-.4-1-1-1H4a2 2 0 0 0-2 2v6c0 1.1.9 2 2 2z"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Hockey</h3>
                        <p class="text-sm text-gray-500">Drills for stick handling, skating speed, and reaction time.</p>
                    </div>
                    <!-- Badminton Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer game-icon-btn" data-sport-name="badminton">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-red-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12L12 22"/><path d="M18 16L6 16"/><path d="M15 10a4 4 0 1 0-8 0c0 2 2 4 4 4s4-2 4-4Z"/><path d="M12 2v4"/><path d="M18 5L21 2"/><path d="M6 5L3 2"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Badminton</h3>
                        <p class="text-sm text-gray-500">Evaluations for footwork, smash speed, and court coverage.</p>
                    </div>
                    <!-- Athletics Card -->
                    <div class="test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer game-icon-btn" data-sport-name="athletics">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-purple-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4.5c-2.5 1.5-5 1.5-7.5 0"/><path d="M12 22v-8"/><path d="M18 10a6 6 0 0 0-12 0c0 4 6 10 6 10s6-6 6-10Z"/></svg>
                        <h3 class="font-semibold text-lg text-gray-900 mb-2">Athletics</h3>
                        <p class="text-sm text-gray-500">Measure performance in sprints, jumps, and throws.</p>
                    </div>
                </div>
            </section>

            <!-- Upcoming Events Section (Moved) -->
            <section>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Upcoming Events</h2>
                <div class="relative w-full h-64 sm:h-80 md:h-96 overflow-hidden rounded-xl shadow-lg perspective-1000">
                    <div id="carousel-container" class="w-full h-full relative preserve-3d">
                        <!-- Carousel slides will be dynamically inserted here -->
                    </div>
                </div>
            </section>

            <!-- Main Leaderboard Section -->
            <section>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">🏆Leaderboard</h2>
                <div class="bg-white shadow-lg rounded-xl overflow-hidden">
                    <!-- Desktop Table -->
                    <table class="min-w-full divide-y divide-gray-200 hidden md:table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">State</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Verification</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fitness Tests</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Record Highlight</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200" id="main-leaderboard-body">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                    <!-- Mobile Cards -->
                    <div id="main-leaderboard-cards" class="md:hidden">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </section>
        </main>
        <!-- Simple footer -->
        <footer class="text-center py-6 text-gray-500 text-sm relative z-10">
            &copy; 2024 Sports Authority of India. All rights reserved.
        </footer>
    </div>
   
       <!-- Profile Modal Overlay (new) -->
<div id="profile-modal-overlay" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
    <div class="modal-content-container bg-white rounded-3xl shadow-2xl p-8 w-11/12 max-w-sm relative">
        <button id="close-profile-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <div class="flex flex-col items-center text-center space-y-6">
            <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-orange-500 bg-gray-200 flex items-center justify-center shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            </div>
            <h2 id="profile-name" class="text-3xl font-extrabold text-gray-900">John Doe</h2>
            <div class="grid grid-cols-2 gap-y-4 gap-x-6 w-full text-left">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500 uppercase">Age</span>
                    <span id="profile-age" class="font-bold text-xl text-gray-900">30</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500 uppercase">Gender</span>
                    <span id="profile-gender" class="font-bold text-xl text-gray-900">Male</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500 uppercase">Height</span>
                    <span id="profile-height" class="font-bold text-xl text-gray-900">175 cm</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500 uppercase">Weight</span>
                    <span id="profile-weight" class="font-bold text-xl text-gray-900">75 kg</span>
                </div>
            </div>
            <div class="w-full bg-gray-100 p-9 rounded-3xl shadow-inner text-left mt-6 flex flex-col space-y-2">
    <div class="flex items-center justify-between">
        <h3 class="font-semibold text-gray-800">BMI</h3>
        <span id="profile-bmi" class="font-extrabold text-2xl text-gray-900">24.5</span>
    </div>
    <div class="flex items-center justify-between">
        <h3 class="font-semibold text-gray-800">Level</h3>
        <span id="profile-level" class="font-extrabold text-2xl text-green-600">Advanced</span>
    </div>
</div>
            <button id="logout-btn" class="w-full mt-6 bg-gray-200 text-gray-800 font-bold py-3 rounded-full hover:bg-gray-300 transition duration-300">Log out or Switch account</button>
        </div>
    </div>
</div>

    <!-- Login Modal Overlay (hidden by default) -->
    <div id="login-modal-overlay" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-sm relative">
            <!-- Back Button -->
            <button id="back-from-login" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-login-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Login</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="email" name="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                    <p id="email-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                    <p id="password-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
                <div class="flex justify-end text-sm">
                    <a href="#" id="forgot-password-link" class="font-medium text-orange-600 hover:text-orange-500">Forgot Password?</a>
                </div>
                <button type="submit" class="w-full bg-orange-600 text-white font-medium py-3 rounded-lg hover:bg-orange-700 transition duration-300">Login</button>
            </form>
        </div>
    </div>

    <!-- Forgot Password Modal Overlay (hidden by default) -->
    <div id="forgot-password-modal-overlay" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-sm relative">
            <!-- Back Button -->
            <button id="back-from-forgot" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-forgot-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Forgot Password</h2>
            <p class="text-sm text-gray-600 mb-4 text-center">Enter your email address to receive an OTP.</p>
            <form class="space-y-4">
                <div>
                    <label for="forgot-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="forgot-email" name="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full bg-orange-600 text-white font-medium py-3 rounded-lg hover:bg-orange-700 transition duration-300">Send OTP</button>
            </form>
        </div>
    </div>

    <!-- Sign Up Modal Overlay (hidden by default) -->
    <div id="signup-modal-overlay" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-lg relative max-h-[90vh] overflow-y-auto">
            <!-- Back Button -->
            <button id="back-from-signup" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-signup-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Sign Up</h2>
            <form id="signup-form" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="first-name" class="block text-sm font-medium text-gray-700">First Name</label>
                        <input type="text" id="first-name" name="first-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="first-name-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                    <div>
                        <label for="last-name" class="block text-sm font-medium text-gray-700">Last Name</label>
                        <input type="text" id="last-name" name="last-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="last-name-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                </div>
                <div>
                    <label for="signup-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="signup-email" name="signup-email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="signup-email-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
                <div>
                    <label for="phone-number" class="block text-sm font-medium text-gray-700">Phone Number</label>
                    <input type="tel" id="phone-number" name="phone-number" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                    <p id="phone-number-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                        <input type="number" id="age" name="age" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="age-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700">Height (in cm)</label>
                        <input type="text" id="height" name="height" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="height-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700">Weight (in kg)</label>
                        <input type="number" id="weight" name="weight" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="weight-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                        <input type="text" id="country" name="country" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="country-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                    <div>
                        <label for="district" class="block text-sm font-medium text-gray-700">District</label>
                        <input type="text" id="district" name="district" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                        <p id="district-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                    <div>
                        <label for="address" class="block text-sm font-medium text-gray-700">Full Address</label>
                        <textarea id="address" name="address" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm"></textarea>
                        <p id="address-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                    </div>
                </div>
                <button type="submit" class="w-full bg-orange-600 text-white font-medium py-3 rounded-lg hover:bg-orange-700 transition duration-300">Sign Up</button>
            </form>
        </div>
    </div>

    <!-- Test Detail Modal Overlay (hidden by default) -->
    <div id="test-detail-modal-overlay" class="test-detail-modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
            <!-- Back Button -->
            <button id="back-from-test-details" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-test-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="test-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Test Title</h2>

            <!-- Tabs Navigation -->
            <div class="flex border-b border-gray-200 mb-6">
                <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="evaluation">Evaluation</button>
                <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="history">Score History</button>
                <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="leaderboard">Leaderboard</button>
            </div>

            <!-- This is the new Evaluation Tab Content -->
<div id="evaluation-tab-content" class="tab-content space-y-6">
    <h3 class="text-lg font-semibold text-gray-800">Submit Your Performance Video</h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
            <label for="test-age" class="block text-sm font-medium text-gray-700">Age</label>
            <input type="number" id="test-age" name="test-age" min="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required>
            <p id="test-age-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
        </div>
        <div>
            <label for="test-gender" class="block text-sm font-medium text-gray-700">Gender</label>
            <select id="test-gender" name="test-gender" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <p id="test-gender-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
        </div>
    </div>
    
    <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
        <h4 class="text-lg font-bold mb-2">Rules for Evaluation</h4>
        <ul class="list-disc list-inside text-sm text-gray-700">
            <li>Ensure the camera is stable and positioned to capture your full body.</li>
            <li>Do not wear loose clothing that may obstruct movement.</li>
            <li>Perform the test in a well-lit area with a clear background.</li>
            <li>The entire test, from start to finish, must be in a single, unedited video.</li>
            <li>Follow all specific test instructions as outlined in the video guide.</li>
        </ul>
    </div>
    
    <!-- Video Recording Controls -->
    <div class="space-y-4">
        <div class="relative bg-black rounded-lg overflow-hidden aspect-video">
            <video id="camera-feed" class="w-full h-full" autoplay muted playsinline></video>
            <video id="video-preview" class="w-full h-full hidden" controls></video>
            <div id="rec-indicator" class="hidden absolute top-4 left-4 flex items-center space-x-2 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold recording-indicator">
                <div class="w-3 h-3 bg-white rounded-full"></div>
                <span>REC</span>
            </div>
        </div>

        <div id="controls-container" class="flex flex-col sm:flex-row items-center justify-center gap-4">
            <button id="start-recording-btn" class="w-full sm:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-700 transition flex items-center justify-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.55a1 1 0 011.45.89V18a1 1 0 01-1.45.89L15 15M4 6h11a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V7a1 1 0 011-1z" /></svg>
                <span>Start Recording</span>
            </button>
            <button id="stop-recording-btn" class="w-full sm:w-auto hidden bg-red-600 text-white font-bold py-3 px-8 rounded-full hover:bg-red-700 transition flex items-center justify-center space-x-2">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9 10h6v4H9z" /></svg>
                <span>Stop Recording</span>
            </button>
            <div id="preview-controls" class="hidden w-full sm:w-auto flex flex-col sm:flex-row items-center justify-center gap-4">
                 <button id="upload-btn" class="w-full sm:w-auto bg-orange-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-orange-700 transition button-shadow">
                    Upload for Analysis
                </button>
                 <button id="rerecord-btn" class="w-full sm:w-auto bg-gray-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-gray-700 transition">
                    Re-record
                </button>
            </div>
        </div>
    </div>

    <!-- Analysis/Results Container -->
    <div id="analysis-results-container" class="hidden mt-6 p-6 bg-white rounded-xl shadow-lg text-center">
        <div id="analysis-loading" class="flex flex-col items-center justify-center space-y-2">
            <div class="spinner h-12 w-12"></div>
            <p class="text-gray-600 font-medium">Analyzing your performance... Please wait.</p>
        </div>
        <div id="analysis-results" class="hidden">
             <h3 class="text-xl font-bold text-gray-900 mb-4">Evaluation Complete!</h3>
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
                <div class="bg-gray-100 p-4 rounded-lg">
                    <p class="font-semibold text-sm uppercase text-gray-500">Repetitions</p>
                    <p id="result-reps" class="text-3xl font-bold text-orange-600"></p>
                </div>
                 <div class="bg-gray-100 p-4 rounded-lg">
                    <p class="font-semibold text-sm uppercase text-gray-500">Fitness Level</p>
                    <p id="result-level" class="text-3xl font-bold text-green-600"></p>
                </div>
            </div>
            <div class="mt-4 p-4 bg-gray-100 rounded-lg shadow-inner">
                <p id="result-date-time" class="text-sm text-gray-500"></p>
            </div>
        </div>
    </div>
</div>


            <div id="history-tab-content" class="tab-content hidden space-y-6">
                <!-- Graph Section -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Performance Trend</h3>
                        <div id="graph-filters" class="flex items-center space-x-1 bg-gray-200 rounded-lg p-1">
                            <button class="graph-filter-btn active" data-duration="week">Last 7 Days</button>
                            <button class="graph-filter-btn" data-duration="month">Last 30 Days</button>
                            <button class="graph-filter-btn" data-duration="all">All Time</button>
                        </div>
                    </div>
                    <div>
                        <canvas id="scoreHistoryChart"></canvas>
                    </div>
                </div>

                <!-- History Table Section -->
                <div class="bg-gray-50 p-6 rounded-lg shadow-inner overflow-y-auto max-h-[300px]">
                     <h3 class="text-lg font-semibold text-gray-800 mb-4">Detailed History</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                <th scope="col" class="relative px-6 py-3"><span class="sr-only">Details</span></th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="leaderboard-tab-content" class="tab-content hidden space-y-6">
                <h3 class="text-lg font-semibold text-gray-800">Leaderboard</h3>
               
                <!-- Filter buttons -->
                <div class="flex space-x-2">
                    <button id="filter-country" class="px-4 py-2 text-sm font-medium rounded-lg bg-orange-600 text-white">Country</button>
                    <button id="filter-state" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">State</button>
                    <button id="filter-district" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">District</button>
                </div>

                <!-- Leaderboard table -->
                <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Athlete</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body" class="bg-white divide-y divide-gray-200">
                            <!-- Leaderboard data will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="test-detail-modal-overlay" class="test-detail-modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
    <div class="modal-content bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
        <!-- Back Button -->
        <button id="back-from-test-details" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <button id="close-test-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <h2 id="test-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Test Title</h2>

        <!-- Tabs Navigation -->
        <div class="flex border-b border-gray-200 mb-6">
            <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="evaluation">Evaluation</button>
            <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="history">Score History</button>
            <button class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-orange-600 hover:border-orange-600 transition duration-300" data-tab-name="leaderboard">Leaderboard</button>
        </div>

        <!-- Tab Content Containers -->
        <div id="evaluation-tab-content" class="tab-content space-y-6">
             <h3 class="text-lg font-semibold text-gray-800">Submit Your Performance Video</h3>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="test-age" class="block text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="test-age" name="test-age" min="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required>
                    <p id="test-age-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
                <div>
                    <label for="test-gender" class="block text-sm font-medium text-gray-700">Gender</label>
                    <select id="test-gender" name="test-gender" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                    <p id="test-gender-error-message" class="text-red-500 text-sm mt-1 hidden">This field is required.</p>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h4 class="text-lg font-bold mb-2">Rules for Evaluation</h4>
                <ul class="list-disc list-inside text-sm text-gray-700">
                    <li>Ensure the camera is stable and positioned to capture your full body.</li>
                    <li>Do not wear loose clothing that may obstruct movement.</li>
                    <li>Perform the test in a well-lit area with a clear background.</li>
                    <li>The entire test, from start to finish, must be in a single, unedited video.</li>
                    <li>Follow all specific test instructions as outlined in the video guide.</li>
                </ul>
            </div>
            
            <!-- Video Recording Controls -->
            <div class="space-y-4">
                <div class="relative bg-black rounded-lg overflow-hidden aspect-video">
                    <video id="camera-feed" class="w-full h-full" autoplay muted playsinline></video>
                    <video id="video-preview" class="w-full h-full hidden" controls></video>
                    <div id="rec-indicator" class="hidden absolute top-4 left-4 flex items-center space-x-2 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold recording-indicator">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                        <span>REC</span>
                    </div>
                </div>

                <div id="controls-container" class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="start-recording-btn" class="w-full sm:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-700 transition flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.55a1 1 0 011.45.89V18a1 1 0 01-1.45.89L15 15M4 6h11a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V7a1 1 0 011-1z" /></svg>
                        <span>Start Recording</span>
                    </button>
                    <button id="stop-recording-btn" class="w-full sm:w-auto hidden bg-red-600 text-white font-bold py-3 px-8 rounded-full hover:bg-red-700 transition flex items-center justify-center space-x-2">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9 10h6v4H9z" /></svg>
                        <span>Stop Recording</span>
                    </button>
                    <div id="preview-controls" class="hidden w-full sm:w-auto flex flex-col sm:flex-row items-center justify-center gap-4">
                         <button id="upload-btn" class="w-full sm:w-auto bg-orange-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-orange-700 transition button-shadow">
                            Upload for Analysis
                        </button>
                         <button id="rerecord-btn" class="w-full sm:w-auto bg-gray-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-gray-700 transition">
                            Re-record
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analysis/Results Container -->
            <div id="analysis-results-container" class="hidden mt-6 p-6 bg-white rounded-xl shadow-lg text-center">
                <div id="analysis-loading" class="flex flex-col items-center justify-center space-y-2">
                    <div class="spinner h-12 w-12"></div>
                    <p class="text-gray-600 font-medium">Analyzing your performance... Please wait.</p>
                </div>
                <div id="analysis-results" class="hidden">
                     <h3 class="text-xl font-bold text-gray-900 mb-4">Evaluation Complete!</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <p class="font-semibold text-sm uppercase text-gray-500">Repetitions</p>
                            <p id="result-reps" class="text-3xl font-bold text-orange-600"></p>
                        </div>
                         <div class="bg-gray-100 p-4 rounded-lg">
                            <p class="font-semibold text-sm uppercase text-gray-500">Fitness Level</p>
                            <p id="result-level" class="text-3xl font-bold text-green-600"></p>
                        </div>
                    </div>
                    <div class="mt-4 p-4 bg-gray-100 rounded-lg shadow-inner">
                        <p id="result-date-time" class="text-sm text-gray-500"></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="history-tab-content" class="tab-content hidden space-y-6">
            <!-- Graph Section -->
            <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Performance Trend</h3>
                    <div id="graph-filters" class="flex items-center space-x-1 bg-gray-200 rounded-lg p-1">
                        <button class="graph-filter-btn active" data-duration="week">Last 7 Days</button>
                        <button class="graph-filter-btn" data-duration="month">Last 30 Days</button>
                        <button class="graph-filter-btn" data-duration="all">All Time</button>
                    </div>
                </div>
                <div>
                    <canvas id="scoreHistoryChart"></canvas>
                </div>
            </div>

            <!-- History Table Section -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner overflow-y-auto max-h-[300px]">
                 <h3 class="text-lg font-semibold text-gray-800 mb-4">Detailed History</h3>
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                            <th scope="col" class="relative px-6 py-3"><span class="sr-only">Details</span></th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- JS will populate this -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="leaderboard-tab-content" class="tab-content hidden space-y-6">
            <h3 class="text-lg font-semibold text-gray-800">Leaderboard</h3>
           
            <!-- Filter buttons -->
            <div class="flex space-x-2">
                <button id="filter-country" class="px-4 py-2 text-sm font-medium rounded-lg bg-orange-600 text-white">Country</button>
                <button id="filter-state" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">State</button>
                <button id="filter-district" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">District</button>
            </div>

            <!-- Leaderboard table -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Athlete</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body" class="bg-white divide-y divide-gray-200">
                        <!-- Leaderboard data will be dynamically loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Score History Pop-up Modal (hidden by default) -->
<div id="score-history-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center p-4">
    <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
        <!-- Back Button -->
        <button id="back-from-history" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <button id="close-history-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <h2 id="history-detail-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Test Evaluation Details</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column: Video and Comments -->
            <div class="space-y-4">
                <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden">
                    <iframe id="history-video-player" class="w-full h-72" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                 <div id="results-display" class="bg-gray-100 p-4 rounded-lg shadow-inner">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Test Results</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
                        <p><strong>Jump Height:</strong> <span id="jumpHeight"></span></p>
                        <p><strong>Cheat Probability:</strong> <span id="cheatProb"></span></p>
                        <p><strong>Benchmark:</strong> <span id="benchmark"></span></p>
                        <p><strong>Status:</strong> <span id="verified"></span></p>
                    </div>
                </div>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Evaluator Comments:</h3>
                    <p id="evaluator-comments" class="text-gray-600"></p>
                </div>
            </div>
            <!-- Right Column: Spider Graph and AI Feedback -->
            <div class="space-y-4">
                 <div class="bg-gray-100 p-4 rounded-lg shadow-inner">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Performance Comparison</h3>
                    <canvas id="performanceComparisonChart"></canvas>
                </div>
                <div class="flex flex-col space-y-4 pt-4">
                    <div class="flex items-center space-x-2">
                        <button id="ai-coach-btn" class="flex-1 bg-orange-600 text-white font-medium py-3 rounded-lg hover:bg-orange-700 transition duration-300 flex items-center justify-center space-x-2">
                            <span>Get AI-powered Feedback ✨</span>
                        </button>
                        <div id="ai-loading" class="hidden spinner h-6 w-6" role="status"></div>
                    </div>
                    <div id="ai-feedback-container" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                        <h4 class="font-semibold text-lg text-gray-800">AI Coach's Analysis</h4>
                        <p id="ai-feedback-text" class="text-gray-700 mt-2"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        </div>
    </div>

    <!-- Custom Message Box (Replaces alert()) -->
    <div id="message-box" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-xl text-center z-[100] transition-opacity duration-300 ease-in-out hidden opacity-0" role="alert">
        <p id="message-text" class="text-lg font-medium"></p>
        <button id="close-message" class="mt-4 bg-orange-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-orange-700">OK</button>
    </div>

    <!-- Score History Pop-up Modal (hidden by default) -->
    <div id="score-history-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center p-4">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
            <!-- Back Button -->
            <button id="back-from-history" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-history-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="history-detail-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Test Evaluation Details</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column: Video and Comments -->
                <div class="space-y-4">
                    <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden">
                        <iframe id="history-video-player" class="w-full h-72" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                     <div id="results-display" class="bg-gray-100 p-4 rounded-lg shadow-inner">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Test Results</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
                            <p><strong>Jump Height:</strong> <span id="jumpHeight"></span></p>
                            <p><strong>Cheat Probability:</strong> <span id="cheatProb"></span></p>
                            <p><strong>Benchmark:</strong> <span id="benchmark"></span></p>
                            <p><strong>Status:</strong> <span id="verified"></span></p>
                        </div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Evaluator Comments:</h3>
                        <p id="evaluator-comments" class="text-gray-600"></p>
                    </div>
                </div>
                <!-- Right Column: Spider Graph and AI Feedback -->
                <div class="space-y-4">
                     <div class="bg-gray-100 p-4 rounded-lg shadow-inner">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Performance Comparison</h3>
                        <canvas id="performanceComparisonChart"></canvas>
                    </div>
                    <div class="flex flex-col space-y-4 pt-4">
                        <div class="flex items-center space-x-2">
                            <button id="ai-coach-btn" class="flex-1 bg-orange-600 text-white font-medium py-3 rounded-lg hover:bg-orange-700 transition duration-300 flex items-center justify-center space-x-2">
                                <span>Get AI-powered Feedback ✨</span>
                            </button>
                            <div id="ai-loading" class="hidden spinner h-6 w-6" role="status"></div>
                        </div>
                        <div id="ai-feedback-container" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                            <h4 class="font-semibold text-lg text-gray-800">AI Coach's Analysis</h4>
                            <p id="ai-feedback-text" class="text-gray-700 mt-2"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal (New) -->
     <div id="performance-analysis-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center p-4">
         <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-2xl relative">
             <button id="close-analysis-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
             </button>
             <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Overall Performance Analysis</h2>
             <div>
                 <canvas id="performanceRadarChart"></canvas>
             </div>
         </div>
     </div>
   
    <!-- Game Test Modal (new) -->
    <div id="game-test-modal-overlay" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
            <button id="close-game-test-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="game-test-title" class="text-2xl font-bold text-gray-900 mb-6 text-center">Football Fitness Tests</h2>

            <!-- Flex container for tests and leaderboard -->
            <div class="flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6">
                <!-- Tests list on the left -->
                <div id="game-tests-list-container" class="lg:w-1/2 space-y-4">
                    <!-- Tests will be loaded here dynamically -->
                </div>
               
                <!-- Leaderboard on the right -->
                <div id="game-test-leaderboard-container" class="lg:w-1/2 space-y-4 hidden">
                    <h3 id="test-leaderboard-title" class="text-xl font-bold text-gray-900">Leaderboard: </h3>
                    <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-white">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Athlete</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                </tr>
                            </thead>
                            <tbody id="game-leaderboard-body" class="bg-white divide-y divide-gray-200">
                                <!-- Leaderboard data will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal (New) -->
    <div id="event-details-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center p-4">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-6xl relative max-h-[95vh] overflow-y-auto">
            <button id="close-event-details-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="event-details-title" class="text-3xl font-bold text-gray-900 mb-6 text-center">Event Details</h2>
           
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Left Column: Description & Facts -->
                <div class="lg:w-1/3 bg-gray-50 p-6 rounded-lg shadow-inner">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">About the Tournament</h3>
                    <p id="event-description-text" class="text-gray-600 mb-4 text-sm"></p>
                    <div id="event-level-badge" class="mb-4"></div>
                   
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Quick Facts</h4>
                    <ul id="event-facts-list" class="space-y-2 text-sm">
                        <!-- Facts will be dynamically inserted here -->
                    </ul>
                </div>

                <!-- Right Column: Sports Grid -->
                <div class="lg:w-2/3">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Events to Take Part In</h3>
                    <div id="sports-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Sports cards will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sport Details Modal (New) -->
    <div id="sport-details-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm z-50 flex justify-center items-center">
        <div class="modal-content-container bg-white rounded-xl shadow-xl p-8 w-11/12 max-w-4xl relative max-h-[95vh] overflow-y-auto">
            <button id="back-to-event-details" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="close-sport-details-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="sport-details-title" class="text-3xl font-bold text-gray-900 mb-2 text-center">Sport Details</h2>
            <p id="sport-details-description" class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">Description of the sport.</p>
           
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Parameters Section -->
                <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Key Performance Parameters</h3>
                    <ul id="sport-parameters-list" class="space-y-2 text-gray-700">
                        <!-- Parameters will be dynamically inserted here -->
                    </ul>
                </div>

                <!-- Records Section -->
                <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Performance Benchmarks</h3>
                    <div id="sport-records-container" class="space-y-4">
                        <!-- Records will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script>
        const ctaButtons = document.querySelectorAll('#cta-button, #hero-cta-button, #final-cta-button');
        const landingPageContent = document.getElementById('landing-page-content');
        const appPageContent = document.getElementById('app-page-content');
        const body = document.body;

        const profileModal = document.getElementById("profile-modal-overlay");
        const loginBtnFromProfile = document.getElementById("login-btn-from-profile");
        const signupBtnFromProfile = document.getElementById("signup-btn-from-profile");
        const loginModal = document.getElementById("login-modal-overlay");
        const signupModal = document.getElementById("signup-modal-overlay");
        const loginForm = document.getElementById("login-form");
        const signupForm = document.getElementById("signup-form");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const emailError = document.getElementById("email-error-message");
        const passwordError = document.getElementById("password-error-message");
        const forgotPasswordLink = document.getElementById("forgot-password-link");
        const forgotPasswordModal = document.getElementById("forgot-password-modal-overlay");
        const closeProfileModalBtn = document.getElementById("close-profile-modal");
        const closeLoginModalBtn = document.getElementById("close-login-modal");
        const closeSignupModalBtn = document.getElementById("close-signup-modal");
        const closeForgotModalBtn = document.getElementById("close-forgot-modal");
        const testCards = document.querySelectorAll(".test-card");
        const testDetailModal = document.getElementById("test-detail-modal-overlay");
        const testTitle = document.getElementById("test-title");
        const closeTestModal = document.getElementById("close-test-modal");
        const tabButtons = document.querySelectorAll(".tab-btn");
        const tabContents = document.querySelectorAll(".tab-content");
        const scoreHistoryModal = document.getElementById("score-history-modal");
        const closeHistoryModal = document.getElementById("close-history-modal");
        const historyVideoPlayer = document.getElementById("history-video-player");
        const evaluatorComments = document.getElementById("evaluator-comments");
        const leaderboardBody = document.getElementById("leaderboard-body");
        const mainContent = document.getElementById("main-content");
        const animatedBackground = document.getElementById("animated-background");
        const backFromLoginBtn = document.getElementById("back-from-login");
        const backFromSignupBtn = document.getElementById("back-from-signup");
        const backFromForgotBtn = document.getElementById("back-from-forgot");
        const backFromTestDetailsBtn = document.getElementById("back-from-test-details");
        const backFromHistoryBtn = document.getElementById("back-from-history");
        const aiCoachBtn = document.getElementById('ai-coach-btn');
        const aiLoading = document.getElementById('ai-loading');
        const aiFeedbackContainer = document.getElementById('ai-feedback-container');
        const aiFeedbackText = document.getElementById('ai-feedback-text');

        // New elements for custom message box
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const closeMessageBtn = document.getElementById('close-message');

        // New elements for evaluation form
        const uploadForm = document.getElementById('uploadForm');
        const testAgeInput = document.getElementById('test-age');
        const testHeightInput = document.getElementById('test-height');
        const testWeightInput = document.getElementById('test-weight');
        const testGenderInput = document.getElementById('test-gender');
        const videoFileInput = document.getElementById('videoFile');
        const videoFileName = document.getElementById('video-file-name');
        const testAgeError = document.getElementById('test-age-error-message');
        const testHeightError = document.getElementById('test-height-error-message');
        const testWeightError = document.getElementById('test-weight-error-message');
        const testGenderError = document.getElementById('test-gender-error-message');
        const videoFileError = document.getElementById('video-file-error-message');
        const uploadLoading = document.getElementById('upload-loading');
       
        // New elements for results display
        const evaluationResultsSection = document.getElementById('evaluation-results-section');
        const evalJumpHeight = document.getElementById('eval-jumpHeight');
        const evalCheatProb = document.getElementById('eval-cheatProb');
        const evalBenchmark = document.getElementById('eval-benchmark');
        const evalVerified = document.getElementById('eval-verified');
        const resultsDisplay = document.getElementById('results-display');
        const jumpHeightSpan = document.getElementById('jumpHeight');
        const cheatProbSpan = document.getElementById('cheatProb');
        const benchmarkSpan = document.getElementById('benchmark');
        const verifiedSpan = document.getElementById('verified');

        // New elements for game-specific tests
        const gameTestIcons = document.querySelectorAll('.game-icon-btn');
        const gameTestModal = document.getElementById('game-test-modal-overlay');
        const closeGameTestModal = document.getElementById('close-game-test-modal');
        const gameTestTitle = document.getElementById('game-test-title');
        const gameTestsListContainer = document.getElementById('game-tests-list-container');
        const gameTestLeaderboardContainer = document.getElementById('game-test-leaderboard-container');
        const testLeaderboardTitle = document.getElementById('test-leaderboard-title');
        const gameLeaderboardBody = document.getElementById('game-leaderboard-body');
       
        // Profile modal elements
        const profileName = document.getElementById('profile-name');
        const profileAge = document.getElementById('profile-age');
        const profileGender = document.getElementById('profile-gender');
        const profileHeight = document.getElementById('profile-height');
        const profileWeight = document.getElementById('profile-weight');
        const profileBMI = document.getElementById('profile-bmi');
        const profileLevel = document.getElementById('profile-level');
        const logoutBtn = document.getElementById('logout-btn');

        // New Modal elements
        const eventDetailsModal = document.getElementById('event-details-modal');
        const closeEventDetailsModalBtn = document.getElementById('close-event-details-modal');
        const eventDetailsTitle = document.getElementById('event-details-title');
        const sportsGrid = document.getElementById('sports-grid');

        const sportDetailsModal = document.getElementById('sport-details-modal');
        const closeSportDetailsModalBtn = document.getElementById('close-sport-details-modal');
        const backToEventDetailsBtn = document.getElementById('back-to-event-details');
        const sportDetailsTitle = document.getElementById('sport-details-title');
        const sportDetailsDescription = document.getElementById('sport-details-description');
        const sportParametersList = document.getElementById('sport-parameters-list');
        const sportRecordsContainer = document.getElementById('sport-records-container');
       
        // New Performance Analysis Modal elements
        const performanceAnalysisModal = document.getElementById('performance-analysis-modal');
        const closeAnalysisModalBtn = document.getElementById('close-analysis-modal');
        const analyzePerformanceBtn = document.getElementById('analyze-performance-btn');


        // New elements for Daily Streaks
        const streakSliderContainer = document.getElementById('streak-slider-container');
        let currentChart = null; // To hold the line chart instance
        let performanceComparisonChart = null; // To hold the radar chart instance
        let overallPerformanceChart = null; // To hold the overall radar chart instance

        // Dummy data for different test streaks
        const dailyStreakData = {
            "Sit Ups":       [true, false, true, true, true, false, false], // Sun, Tue, Wed, Thu
            "Push Ups":      [false, true, false, false, true, false, false], // Mon, Thu
            "Vertical Height Jump": [true, true, true, false, true, true, true], // Sun, Mon, Tue, then broken, then Fri, Sat, Sun
            "Sit and Reach":   [true, true, true, true, true, true, true] // Everyday!
        };

        const scoreHistoryData = {
            "Sit Ups": [
                { date: "2024-03-01", score: 45, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "Good pace, try to control the descent more." },
                { date: "2024-03-03", score: 48, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "Improvement in consistency." },
                { date: "2024-03-05", score: 50, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "Excellent form! Keep it up." },
                { date: "2024-03-08", score: 52, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "Slight fatigue towards the end." },
                { date: "2024-03-12", score: 51, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "A small dip, focus on recovery." },
                { date: "2024-03-15", score: 55, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "New personal best! Great work." },
                { date: "2024-03-20", score: 58, videoUrl: "https://www.youtube.com/embed/1fbU_MkV7NE", comments: "Fantastic performance, very strong." }
            ],
            "Push Ups": [
                { date: "2024-03-02", score: 30, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Keep your back straight." },
                { date: "2024-03-04", score: 32, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Better depth this time." },
                { date: "2024-03-07", score: 35, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Strong and steady." },
                { date: "2024-03-10", score: 36, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Power output is increasing." },
                { date: "2024-03-14", score: 38, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Great consistency in your reps." },
                { date: "2024-03-18", score: 40, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Solid milestone reached." },
                { date: "2024-03-22", score: 42, videoUrl: "https://www.youtube.com/embed/IODxDxX7oi4", comments: "Excellent work on maintaining form." }
            ],
            "Vertical Height Jump": [
                { date: "2024-02-10", score: 40, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Focus on explosive power from your legs." },
                { date: "2024-02-15", score: 42, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Good use of arm swing." },
                { date: "2024-02-20", score: 41, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Landing was a bit off-balance." },
                { date: "2024-02-25", score: 44, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Great improvement in height." },
                { date: "2024-03-01", score: 48, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Explosiveness is clearly better." },
                { date: "2024-03-05", score: 50, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Fantastic jump! A new record." },
                { date: "2024-03-10", score: 52, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Consistent and powerful." },
                { date: "2024-03-15", score: 55, videoUrl: "https://www.youtube.com/embed/oG7kLqS7qYg", comments: "Amazing height, professional level." }
            ],
            "Sit and Reach": [
                { date: "2024-03-01", score: 15, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Good starting point." },
                { date: "2024-03-04", score: 16, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Slight improvement, keep stretching." },
                { date: "2024-03-06", score: 18, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Noticeable increase in flexibility." },
                { date: "2024-03-09", score: 17, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Maintain consistent practice." },
                { date: "2024-03-13", score: 20, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Great job breaking the 20cm mark." },
                { date: "2024-03-17", score: 22, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Flexibility is much better." },
                { date: "2024-03-21", score: 23, videoUrl: "https://www.youtube.com/embed/TS1z-A0o3-k", comments: "Excellent result." }
            ]
        };

        // Dummy data for the overall performance radar chart
        const userPerformanceData = {
            'Agility (Shuttle Run)': 80,
            'Power (Vertical Jump)': 75,
            'Core Strength (Sit-ups)': 70,
            'Endurance (1600m Run)': 60,
            'Speed (40m Dash)': 85
        };

        const nationalBenchmarkData = {
            'Agility (Shuttle Run)': 85,
            'Power (Vertical Jump)': 70,
            'Core Strength (Sit-ups)': 75,
            'Endurance (1600m Run)': 65,
            'Speed (40m Dash)': 80
        };


        const leaderboardData = {
            country: [
                { rank: 1, name: "Neeraj Chopra", score: "88.44 m" },
                { rank: 2, name: "Hima Das", score: "50.79 s" },
                { rank: 3, name: "P.V. Sindhu", score: "89 km/h" },
            ],
            state: [
                { rank: 1, name: "M. Manisha", score: "58 cm" },
                { rank: 2, name: "A. Sharma", score: "54 cm" },
                { rank: 3, name: "B. Singh", score: "52 cm" },
            ],
            district: [
                { rank: 1, name: "C. Kumar", score: "60 cm" },
                { rank: 2, name: "D. Devi", score: "59 cm" },
                { rank: 3, name: "E. Patel", score: "57 cm" },
            ],
        };

        const mainLeaderboardData = [
            {
                rank: 1,
                name: "Neeraj Chopra",
                address: "Panipat, Haryana",
                state: "Haryana",
                verified: true,
                tests: {
                    "Javelin Throw": "88.44m",
                    "Sprint 400m": "50.79s",
                    "High Jump": "2.10m"
                },
                recordHighlight: "Javelin Throw (88.44m)"
            },
            {
                rank: 2,
                name: "P.V. Sindhu",
                address: "Hyderabad, Telangana",
                state: "Telangana",
                verified: true,
                tests: {
                    "Badminton Smash Speed": "340 km/h",
                    "Vertical Jump": "55cm"
                },
                recordHighlight: "Badminton Smash (340 km/h)"
            },
            {
                rank: 3,
                name: "Virat Kohli",
                address: "Delhi",
                state: "Delhi",
                verified: false,
                tests: {
                    "Push-Ups": "75 reps",
                    "Sprint 100m": "11.5s"
                },
                recordHighlight: "Push-Ups (75 reps)"
            }
        ];

        const gameSpecificTestDetails = {
            football: {
                name: "Football Fitness Tests",
                tests: [
                    { name: "Agility Cone Test", description: "Measures quickness, agility, and change of direction." },
                    { name: "30-meter Sprint", description: "Assesses acceleration and straight-line speed." },
                    { name: "Vertical Jump", description: "Measures explosive leg power." },
                ],
                leaderboards: {
                    "Agility Cone Test": [
                        { rank: 1, name: "A. Singh", score: "12.5s" },
                        { rank: 2, name: "B. Das", score: "12.8s" },
                    ],
                    "30-meter Sprint": [
                        { rank: 1, name: "C. Kumar", score: "3.9s" },
                        { rank: 2, name: "D. Patel", score: "4.1s" },
                    ],
                    "Vertical Jump": [
                         { rank: 1, name: "E. Sharma", score: "65cm" },
                         { rank: 2, name: "F. Khan", score: "62cm" },
                    ],
                }
            },
            cricket: {
                name: "Cricket Fitness Tests",
                tests: [
                    { name: "2km Time Trial", description: "Measures cardiovascular endurance." },
                    { name: "Yo-Yo Test", description: "Evaluates repeated sprint ability and endurance." },
                ],
                leaderboards: {
                    "2km Time Trial": [
                        { rank: 1, name: "G. Rahul", score: "7:15 min" },
                        { rank: 2, name: "H. Rohit", score: "7:25 min" },
                    ],
                    "Yo-Yo Test": [
                        { rank: 1, name: "I. Kohli", score: "22.1" },
                        { rank: 2, name: "J. Ashwin", score: "21.5" },
                    ],
                }
            },
            hockey: {
                name: "Hockey Fitness Tests",
                tests: [
                    { name: "Multi-stage Fitness Test", description: "Assesses aerobic fitness and endurance." },
                    { name: "Illinois Agility Test", description: "Measures speed, balance, and agility." },
                ],
                 leaderboards: {
                    "Multi-stage Fitness Test": [
                        { rank: 1, name: "K. Singh", score: "Level 14.2" },
                        { rank: 2, name: "L. Kumar", score: "Level 14.0" },
                    ],
                    "Illinois Agility Test": [
                        { rank: 1, name: "M. Rani", score: "15.5s" },
                        { rank: 2, name: "N. Kaur", score: "15.8s" },
                    ],
                }
            },
            badminton: {
                name: "Badminton Fitness Tests",
                tests: [
                    { name: "Badminton-Specific Agility Test", description: "Measures agility and quick footwork specific to badminton." },
                    { name: "Vertical Jump", description: "Measures explosive leg power for smashes and jumps." },
                ],
                 leaderboards: {
                    "Badminton-Specific Agility Test": [
                        { rank: 1, name: "P. Sindhu", score: "20.1s" },
                        { rank: 2, name: "S. Nehwal", score: "20.5s" },
                    ],
                    "Vertical Jump": [
                        { rank: 1, name: "Q. Varma", score: "58cm" },
                        { rank: 2, name: "R. Sharma", score: "56cm" },
                    ],
                }
            },
            athletics: {
                name: "Athletics Fitness Tests",
                tests: [
                    { name: "100m Sprint", description: "Measures maximum sprinting speed." },
                    { name: "Javelin Throw", description: "Measures explosive power and coordination." },
                    { name: "Shot Put", description: "Tests upper body power and technique." },
                ],
                 leaderboards: {
                    "100m Sprint": [
                        { rank: 1, name: "T. Usain", score: "9.8s" },
                        { rank: 2, name: "U. Carl", score: "9.9s" },
                    ],
                    "Javelin Throw": [
                        { rank: 1, name: "V. Neeraj", score: "88.44m" },
                        { rank: 2, name: "W. Keshorn", score: "84.1m" },
                    ],
                    "Shot Put": [
                         { rank: 1, name: "X. Ryan", score: "22.5m" },
                         { rank: 2, name: "Y. Tom", score: "22.1m" },
                    ],
                }
            },
        };

    const majorEventsData = {
    olympics: {
        name: "Paris Olympics 2024",
        date: "July 26 - August 11, 2024",
        description: "The premier international multi-sport event, showcasing the world's best athletes in a celebration of sport and unity. It is the pinnacle of athletic achievement.",
        imageUrl: "paris.jpg",
        level: "Global Pinnacle",
        facts: [
            "The first modern Olympics were held in Athens, Greece, in 1896.",
            "The five rings represent the five inhabited continents of the world.",
            "India first participated in the Olympics in 1900."
        ],
        sports: {
            boxing: {
                name: "Boxing",
                description: "A combat sport where two opponents test their strength, speed, reflexes, and endurance by throwing punches.",
                parameters: ["Punch Speed (m/s)", "Reaction Time (ms)", "Max Punch Force (N)", "Footwork Agility", "Stamina (VO2 Max)", "Defensive Slips/Min", "Jab Accuracy (%)"],
                records: {
                    top: [
                        { benchmark: "Punch Speed > 10 m/s", athlete: "Olympic Champion Level", details: "Elite boxers generate incredible speed, often faster than the blink of an eye." },
                        { benchmark: "Reaction Time < 100 ms", athlete: "World Record Holder", details: "The ability to react instantly to an opponent's move is critical at the highest level." }
                    ],
                    average: [
                        { benchmark: "Punch Speed: 6-8 m/s", athlete: "National Level Competitor", details: "A solid benchmark for athletes competing at the national championships." },
                        { benchmark: "Jab Accuracy > 60%", athlete: "State Level Medalist", details: "Consistency in landing jabs is a key indicator of a skilled boxer." }
                    ]
                }
            },
            archery: {
                name: "Archery",
                description: "The art, sport, and skill of using a bow to shoot arrows, requiring immense precision and mental focus.",
                parameters: ["Arrow Grouping Accuracy (cm)", "Heart Rate Control (bpm)", "Aim Stability", "Draw Weight (lbs)", "Wind Reading Accuracy", "Shot Execution Time (s)"],
                records: {
                    top: [
                        { benchmark: "Perfect Score (900/900)", athlete: "World Record Holder", details: "Achieving a perfect score in a 90-arrow round is the pinnacle of archery precision." },
                        { benchmark: "Heart Rate < 60 bpm under pressure", athlete: "Olympic Medalist", details: "Maintaining calm and control is as crucial as physical skill." }
                    ],
                    average: [
                        { benchmark: "Score > 850/900", athlete: "National Team Selection", details: "Consistently scoring above 850 is often required for national team consideration." },
                        { benchmark: "Arrow Grouping < 5cm at 70m", athlete: "Junior National Champion", details: "Tight arrow grouping is a fundamental skill for competitive archers." }
                    ]
                }
            },
            athletics: {
                name: "Athletics (Javelin)",
                description: "A collection of sporting events that involve competitive running, jumping, throwing, and walking. Focus on Javelin.",
                parameters: ["Javelin Throw Distance (m)", "Run-up Speed (m/s)", "Release Angle (degrees)", "Core Strength (Med Ball Throw)", "Flexibility (Shoulder Range)"],
                records: {
                    top: [
                        { benchmark: "Javelin Throw > 90m", athlete: "World Champion Level", details: "Only a handful of athletes have ever surpassed the 90-meter mark." },
                        { benchmark: "Run-up speed > 6 m/s", athlete: "Neeraj Chopra", details: "Generating high speed during the run-up is crucial for a powerful throw." }
                    ],
                    average: [
                        { benchmark: "Javelin Throw > 75m", athlete: "National Record Holder", details: "A throw over 75 meters is highly competitive at the national level in India." },
                        { benchmark: "Release Angle: 33-37 degrees", athlete: "University Level Champion", details: "Mastering the optimal release angle is key to maximizing distance." }
                    ]
                }
            }
        }
    },
    commonwealth: {
        name: "Commonwealth Games 2026",
        date: "March 17-29, 2026",
        description: "A multi-sport event among athletes from the Commonwealth of Nations, often referred to as the 'Friendly Games' for its spirit of camaraderie.",
        imageUrl: "commonwealth.png",
        level: "International",
        facts: [
            "It is an international multi-sport event involving athletes from the Commonwealth of Nations.",
            "Only six teams have attended every Commonwealth Games since its inception in 1930.",
            "India hosted the games in 2010 in Delhi, a landmark event for the country."
        ],
        sports: {
            weightlifting: {
                name: "Weightlifting",
                description: "An athletic discipline in which the athlete attempts a single maximum-weight lift of a barbell loaded with weight plates.",
                parameters: ["Snatch Max (kg)", "Clean & Jerk Max (kg)", "Bodyweight to Lift Ratio", "Grip Strength (kg)", "Leg Power (Vertical Jump)"],
                records: {
                    top: [
                        { benchmark: "Total Lift > 2.5x Bodyweight", athlete: "Mirabai Chanu", details: "Lifting more than double one's bodyweight is a sign of an elite competitor." },
                        { benchmark: "Clean & Jerk > 140kg", athlete: "World Record Holder (Category)", details: "This level of strength is seen only at the highest international competitions." }
                    ],
                    average: [
                        { benchmark: "Total Lift > 2x Bodyweight", athlete: "National Champion", details: "A common benchmark for medal winners at national events." },
                        { benchmark: "Snatch: 90-100kg", athlete: "State Level Gold Medalist", details: "Mastery of the snatch technique at this weight is crucial for progression." }
                    ]
                }
            },
            wrestling: {
                name: "Wrestling",
                description: "A combat sport involving grappling-type techniques such as clinch fighting, throws and takedowns, joint locks, and pins.",
                parameters: ["Takedown Success Rate (%)", "Defensive Score", "Stamina Index (Lactate Threshold)", "Grip Endurance (s)", "Reaction to Takedown (ms)"],
                records: {
                    top: [
                        { benchmark: "Takedown Rate > 80%", athlete: "Olympic Champion Level", details: "Dominant wrestlers consistently succeed in their takedown attempts." },
                        { benchmark: "0 points conceded in a tournament", athlete: "Bajrang Punia (at times)", details: "A perfect defensive record is a rare and incredible feat." }
                    ],
                    average: [
                        { benchmark: "Takedown Rate > 50%", athlete: "National Level Medalist", details: "Securing more than half of takedown attempts is a strong indicator of skill." },
                        { benchmark: "Win by technical superiority", athlete: "Junior National Competitor", details: "Demonstrates a significant skill gap against opponents." }
                    ]
                }
            }
        }
    },
    khelo_india: {
        name: "Khelo India Youth Games",
        date: "Annually in Winter",
        description: "A national level multi-disciplinary grassroots games in India, introduced to revive the sports culture at the ground level for under-17 and under-21 athletes.",
        imageUrl: "khelo.webp",
        level: "National - Grassroots",
        facts: [
            "Aimed at identifying and nurturing young sporting talent across India.",
            "Top-performing athletes receive annual scholarships for training and development.",
            "Promotes a wide range of traditional Indian sports alongside modern disciplines."
        ],
        sports: {
            swimming: {
                name: "Swimming",
                description: "Competitive swimming involves racing through water using various strokes.",
                parameters: ["50m Freestyle Time (s)", "Turn Efficiency (%)", "Start Reaction Time (ms)", "Stroke Rate (strokes/min)", "Underwater Dolphin Kicks"],
                records: {
                    top: [
                        { benchmark: "50m Freestyle < 22s", athlete: "World Record Pace", details: "Breaking the 22-second barrier is a mark of a world-class sprinter." },
                        { benchmark: "Start Reaction < 0.6s", athlete: "Olympic Finalist", details: "An explosive start can make a significant difference in short races." }
                    ],
                    average: [
                        { benchmark: "50m Freestyle < 25s", athlete: "National Record Holder", details: "This is a highly competitive time at the Indian national level." },
                        { benchmark: "Turn Efficiency > 90%", athlete: "State Champion", details: "Minimizing time loss during turns is crucial for competitive swimmers." }
                    ]
                }
            },
            kabaddi: {
                name: "Kabaddi",
                description: "A contact team sport that requires both skill and power, combining elements of wrestling and rugby.",
                parameters: ["Successful Raid Points per match", "Tackle Success Rate (%)", "Time on Mat (min)", "Avg. Raid Time (s)", "Super Raids"],
                records: {
                    top: [
                        { benchmark: "Avg. 10+ Raid Points/Match", athlete: "Pardeep Narwal", details: "Consistently scoring high raid points is the mark of a star raider." },
                        { benchmark: "Tackle Success Rate > 60%", athlete: "Pro Kabaddi Best Defender", details: "Elite defenders have a high success rate in stopping raiders." }
                    ],
                    average: [
                        { benchmark: "Avg. 5-7 Raid Points/Match", athlete: "National Level Raider", details: "A solid contribution that can win matches for the team." },
                        { benchmark: "Tackle Success Rate > 40%", athlete: "State Level Defender", details: "A reliable defender who can contribute crucial tackle points." }
                    ]
                }
            }
        }
    }
};

        let currentMajorEvent = null; // To keep track of the currently viewed major event

        // Function to show a modal with transition
        function showModal(modal) {
            modal.classList.remove("hidden");
            document.body.style.overflow = "hidden";
            setTimeout(() => {
                modal.classList.add("modal-active");
            }, 10);
        }

        // Function to hide a modal with transition
        function hideModal(modal) {
            modal.classList.remove("modal-active");
            document.body.style.overflow = "auto";
            setTimeout(() => {
                modal.classList.add("hidden");
            }, 300);
        }

        // Handle navigation from landing page to app page
        ctaButtons.forEach(button => {
            button.addEventListener('click', () => {
                landingPageContent.classList.add('hidden');
                appPageContent.classList.remove('hidden');
                body.classList.add('app-background');
                showModal(profileModal);
                runAppPageScripts();
            });
        });
       
        const backToLandingBtn = document.getElementById('back-to-landing-btn');
        if (backToLandingBtn) {
            backToLandingBtn.addEventListener('click', () => {
                // First, hide any currently open modals to ensure a clean transition
                if (!profileModal.classList.contains('hidden')) hideModal(profileModal);
                if (!loginModal.classList.contains('hidden')) hideModal(loginModal);
                if (!signupModal.classList.contains('hidden')) hideModal(signupModal);
                if (!forgotPasswordModal.classList.contains('hidden')) hideModal(forgotPasswordModal);
                if (!testDetailModal.classList.contains('hidden')) hideModal(testDetailModal);
                if (!scoreHistoryModal.classList.contains('hidden')) hideModal(scoreHistoryModal);
                if (!gameTestModal.classList.contains('hidden')) hideModal(gameTestModal);

                // Then, transition back to the landing page
                appPageContent.classList.add('hidden');
                landingPageContent.classList.remove('hidden');
                body.classList.remove('app-background');
            });
        }


        const profileButtonApp = document.getElementById("profile-menu-button-app");
        if (profileButtonApp) {
            profileButtonApp.addEventListener("click", () => {
                updateProfileModal();
                showModal(profileModal);
            });
        }
       
        closeProfileModalBtn.addEventListener("click", () => hideModal(profileModal));
        closeLoginModalBtn.addEventListener("click", () => hideModal(loginModal));
        closeSignupModalBtn.addEventListener("click", () => hideModal(signupModal));
        closeForgotModalBtn.addEventListener("click", () =>
            hideModal(forgotPasswordModal)
        );
        closeGameTestModal.addEventListener("click", () => {
             hideModal(gameTestModal);
             mainContent.classList.remove("hidden");
             animatedBackground.classList.remove("hidden");
        });


        // Test Details Modals
        closeTestModal.addEventListener("click", () => {
            hideModal(testDetailModal);
            mainContent.classList.remove("hidden");
            animatedBackground.classList.remove("hidden");
        });

        closeHistoryModal.addEventListener("click", () => {
            hideModal(scoreHistoryModal);
            historyVideoPlayer.src = "";
            aiFeedbackContainer.classList.add('hidden');
            resultsDisplay.classList.add('hidden');
        });
       
        closeMessageBtn.addEventListener('click', () => {
            hideModal(messageBox);
        });
       
        function showMessage(message, type = 'info') {
            messageText.textContent = message;
            if (type === 'error') {
                messageBox.className = 'fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-xl text-center z-[100] transition-opacity duration-300 ease-in-out bg-red-500 text-white';
            } else if (type === 'success') {
                messageBox.className = 'fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-xl text-center z-[100] transition-opacity duration-300 ease-in-out bg-green-500 text-white';
            } else {
                messageBox.className = 'fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-xl text-center z-[100] transition-opacity duration-300 ease-in-out bg-blue-500 text-white';
            }
            showModal(messageBox);
        }


        backFromLoginBtn.addEventListener("click", () => {
            hideModal(loginModal);
            showModal(profileModal);
        });

        backFromSignupBtn.addEventListener("click", () => {
            hideModal(signupModal);
            showModal(profileModal);
        });

        backFromForgotBtn.addEventListener("click", () => {
            hideModal(forgotPasswordModal);
            showModal(loginModal);
        });

        backFromTestDetailsBtn.addEventListener("click", () => {
            hideModal(testDetailModal);
            mainContent.classList.remove("hidden");
            animatedBackground.classList.remove("hidden");
        });

        [
            profileModal,
            loginModal,
            signupModal,
            forgotPasswordModal,
            testDetailModal,
            scoreHistoryModal,
            gameTestModal,
            performanceAnalysisModal,
            eventDetailsModal, // Add new modals to the list
            sportDetailsModal,
        ].forEach((modal) => {
            modal.addEventListener("click", (event) => {
                const content = modal.querySelector(
                    ".modal-content-container, .modal-content"
                );
                if (content && !content.contains(event.target)) {
                    if (modal.id === "test-detail-modal-overlay" || modal.id === "game-test-modal-overlay") {
                        hideModal(modal);
                        mainContent.classList.remove("hidden");
                        animatedBackground.classList.remove("hidden");
                    } else {
                        hideModal(modal);
                    }
                }
            });
        });

        function validateField(inputElement, errorMessageElement) {
            if (inputElement.value.trim() === "") {
                errorMessageElement.classList.remove("hidden");
                inputElement.classList.add("border-red-500");
                return false;
            } else {
                errorMessageElement.classList.add("hidden");
                inputElement.classList.remove("border-red-500");
                return true;
            }
        }
       
        function validateFile(fileInput, errorMessageElement) {
            if (fileInput.files.length === 0) {
                errorMessageElement.classList.remove("hidden");
                return false;
            } else {
                errorMessageElement.classList.add("hidden");
                return true;
            }
        }

        if (loginForm) {
            loginForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const isEmailValid = validateField(emailInput, emailError);
                const isPasswordValid = validateField(passwordInput, passwordError);
                if (isEmailValid && isPasswordValid) {
                    console.log("Login successful! (Simulated)");
                }
            });
        }
       
        if (signupForm) {
            signupForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const firstNameInput = document.getElementById("first-name");
                const lastNameInput = document.getElementById("last-name");
                const signupEmailInput = document.getElementById("signup-email");
                const phoneNumberInput = document.getElementById("phone-number");
                const ageInput = document.getElementById("age");
                const heightInput = document.getElementById("height");
                const weightInput = document.getElementById("weight");
                const countryInput = document.getElementById("country");
                const districtInput = document.getElementById("district");
                const addressInput = document.getElementById("address");

                const isFirstNameValid = validateField(
                    firstNameInput,
                    document.getElementById("first-name-error-message")
                );
                const isLastNameValid = validateField(
                    lastNameInput,
                    document.getElementById("last-name-error-message")
                );
                const isSignupEmailValid = validateField(
                    signupEmailInput,
                    document.getElementById("signup-email-error-message")
                );
                const isPhoneNumberValid = validateField(
                    phoneNumberInput,
                    document.getElementById("phone-number-error-message")
                );
                const isAgeValid = validateField(
                    ageInput,
                    document.getElementById("age-error-message")
                );
                const isHeightValid = validateField(
                    heightInput,
                    document.getElementById("height-error-message")
                );
                const isWeightValid = validateField(
                    weightInput,
                    document.getElementById("weight-error-message")
                );
                const isCountryValid = validateField(
                    countryInput,
                    document.getElementById("country-error-message")
                );
                const isDistrictValid = validateField(
                    districtInput,
                    document.getElementById("district-error-message")
                );
                const isAddressValid = validateField(
                    addressInput,
                    document.getElementById("address-error-message")
                );

                if (
                    isFirstNameValid &&
                    isLastNameValid &&
                    isSignupEmailValid &&
                    isPhoneNumberValid &&
                    isAgeValid &&
                    isHeightValid &&
                    isWeightValid &&
                    isCountryValid &&
                    isDistrictValid &&
                    isAddressValid
                ) {
                    console.log("Sign up successful! (Simulated)");
                }
            });
        }

        if (emailInput) emailInput.addEventListener("input", () => validateField(emailInput, emailError));
        if (passwordInput) passwordInput.addEventListener("input", () => validateField(passwordInput, passwordError));
        if (document.getElementById("first-name")) document.getElementById("first-name").addEventListener("input", () => validateField(document.getElementById("first-name"), document.getElementById("first-name-error-message")));
        if (document.getElementById("last-name")) document.getElementById("last-name").addEventListener("input", () => validateField(document.getElementById("last-name"), document.getElementById("last-name-error-message")));
        if (document.getElementById("signup-email")) document.getElementById("signup-email").addEventListener("input", () => validateField(document.getElementById("signup-email"), document.getElementById("signup-email-error-message")));
        if (document.getElementById("phone-number")) document.getElementById("phone-number").addEventListener("input", () => validateField(document.getElementById("phone-number"), document.getElementById("phone-number-error-message")));
        if (document.getElementById("age")) document.getElementById("age").addEventListener("input", () => validateField(document.getElementById("age"), document.getElementById("age-error-message")));
        if (document.getElementById("height")) document.getElementById("height").addEventListener("input", () => validateField(document.getElementById("height"), document.getElementById("height-error-message")));
        if (document.getElementById("weight")) document.getElementById("weight").addEventListener("input", () => validateField(document.getElementById("weight"), document.getElementById("weight-error-message")));
        if (document.getElementById("country")) document.getElementById("country").addEventListener("input", () => validateField(document.getElementById("country"), document.getElementById("country-error-message")));
        if (document.getElementById("district")) document.getElementById("district").addEventListener("input", () => validateField(document.getElementById("district"), document.getElementById("district-error-message")));
        if (document.getElementById("address")) document.getElementById("address").addEventListener("input", () => validateField(document.getElementById("address"), document.getElementById("address-error-message")));
       
        // New event listeners for the evaluation form fields
        if (testAgeInput) testAgeInput.addEventListener("input", () => validateField(testAgeInput, testAgeError));
        if (testHeightInput) testHeightInput.addEventListener("input", () => validateField(testHeightInput, testHeightError));
        if (testWeightInput) testWeightInput.addEventListener("input", () => validateField(testWeightInput, testWeightError));
        if (testGenderInput) testGenderInput.addEventListener("input", () => validateField(testGenderInput, testGenderError));
        if (videoFileInput) {
            videoFileInput.addEventListener('change', () => {
                if (videoFileInput.files.length > 0) {
                    videoFileName.textContent = videoFileInput.files[0].name;
                } else {
                    videoFileName.textContent = 'Click to upload your video';
                }
            });
        }


        let lastEvaluationResults = null;

           
        function runAppPageScripts() {
            // Updated: Daily Streaks Logic with slider buttons
            function setupStreakSlider() {
                const testNames = Object.keys(dailyStreakData);
                streakSliderContainer.innerHTML = ''; // Clear previous buttons

                testNames.forEach(name => {
                    const button = document.createElement('button');
                    button.className = 'streak-slider-btn';
                    button.textContent = name;
                    button.dataset.testName = name;
                    button.addEventListener('click', () => {
                        // Remove active class from all buttons
                        streakSliderContainer.querySelectorAll('.streak-slider-btn').forEach(btn => btn.classList.remove('active'));
                        // Add active class to the clicked button
                        button.classList.add('active');
                        // Render the streaks for the selected test
                        renderDailyStreaks(name);
                    });
                    streakSliderContainer.appendChild(button);
                });
               
                // Initial render with the first test in the list
                if (testNames.length > 0) {
                    streakSliderContainer.querySelector('.streak-slider-btn').classList.add('active');
                    renderDailyStreaks(testNames[0]);
                }
            }
           
            function renderDailyStreaks(testName) {
                const streaksContainer = document.getElementById('daily-streaks-container');
                const currentStreakCount = document.getElementById('current-streak-count');
               
                const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                const today = new Date().getDay(); // Sunday = 0, Monday = 1, etc.
                const streakData = dailyStreakData[testName] || [false, false, false, false, false, false, false];
               
                streaksContainer.innerHTML = '';
                let currentConsecutiveStreak = 0;

                // Calculate current consecutive streak ending 'today'
                for (let i = today; i >= 0; i--) {
                    if (streakData[i]) {
                        currentConsecutiveStreak++;
                    } else {
                        break; // Streak broken
                    }
                }
               
                streakData.forEach((isActive, index) => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'text-center';

                    const circle = document.createElement('div');
                    circle.className = `streak-day w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-300 ${isActive ? 'active' : 'bg-gray-200 text-gray-400'}`;
                    circle.textContent = days[index];
                   
                    dayElement.appendChild(circle);

                    if (index === today) {
                        const todayLabel = document.createElement('p');
                        todayLabel.className = 'text-xs mt-1 font-bold text-orange-600';
                        todayLabel.textContent = 'Today';
                        dayElement.appendChild(todayLabel);
                    }

                    streaksContainer.appendChild(dayElement);
                });
               
                currentStreakCount.textContent = `${currentConsecutiveStreak} ${currentConsecutiveStreak === 1 ? 'Day' : 'Days'}`;
            }


            const carouselContainer = document.getElementById("carousel-container");
            const majorEventKeys = Object.keys(majorEventsData);
            let currentSlide = 0;

       const showSlide = () => {
    const eventKey = majorEventKeys[currentSlide];
    const slideData = majorEventsData[eventKey];
    const slideElement = document.createElement("div");
    slideElement.className = "absolute top-0 left-0 w-full h-full bg-cover bg-center fade-in flex flex-col items-center justify-end text-center p-8 cursor-pointer";
    slideElement.style.backgroundImage = `url('${slideData.imageUrl}')`;
    slideElement.innerHTML = `
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
        <div class="relative z-10 text-white space-y-3">
            <h2 class="text-3xl sm:text-5xl md:text-6xl font-extrabold drop-shadow-lg">${slideData.name}</h2>
            <p class="text-lg font-medium drop-shadow-lg">${slideData.date}</p>
            <p class="text-md max-w-2xl mx-auto drop-shadow-lg">${slideData.description}</p>
            <button class="mt-4 bg-orange-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-orange-700 transition duration-300 view-event-details-btn" data-event-key="${eventKey}">
                View Details
            </button>
        </div>`;

    while (carouselContainer.firstChild) {
        carouselContainer.firstChild.remove();
    }
    carouselContainer.appendChild(slideElement);

    // Add event listener to the new button
    slideElement.querySelector('.view-event-details-btn').addEventListener('click', (e) => {
        const key = e.target.dataset.eventKey;
        openEventDetailsModal(key);
    });
};
            const nextSlide = () => {
                currentSlide = (currentSlide + 1) % majorEventKeys.length;
                showSlide();
            };
           
            showSlide();
            setInterval(nextSlide, 5000);
            setupStreakSlider(); // Initialize daily streaks slider
           
                // --- Training Goals Logic (V3 - Date Selector UI) ---
const goalInput = document.getElementById('goal-input');
const goalCustomDateInput = document.getElementById('goal-custom-date-input');
const addGoalBtn = document.getElementById('add-goal-btn');
const goalsListContainer = document.getElementById('goals-list-container');
const goalsReminderContainer = document.getElementById('goals-reminder-container');
const goalsViewToggle = document.getElementById('goals-view-toggle');
const clearCompletedContainer = document.getElementById('clear-completed-container');
const dateButtonsContainer = document.getElementById('date-buttons-container');
const dailyGoalsDateSelector = document.getElementById('daily-goals-date-selector');

let currentView = 'daily'; // 'daily' or 'overall'
let selectedDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format
let goalsData = { daily: [], overall: [] };

// Initialize the goals feature
function initGoals() {
    goalsData = JSON.parse(localStorage.getItem('trainingGoalsV3')) || { daily: [], overall: [] };
    setupDateSelector();

    goalsViewToggle.addEventListener('click', (e) => {
        if (e.target.matches('.goal-toggle-btn')) {
            switchView(e.target.dataset.view);
        }
    });

    addGoalBtn.addEventListener('click', addGoal);
    goalInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addGoal();
    });

    switchView(currentView);
}

function setupDateSelector() {
    dateButtonsContainer.innerHTML = '';
    const today = new Date();

    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateString = date.toISOString().split('T')[0];

        const button = document.createElement('button');
        button.className = 'date-selector-btn';
        button.dataset.date = dateString;
        button.innerHTML = `
            <div class="font-bold">${date.getDate()}</div>
            <div class="text-xs">${date.toLocaleDateString('en-US', { weekday: 'short' })}</div>
        `;
       
        button.addEventListener('click', () => {
            selectedDate = dateString;
            goalCustomDateInput.classList.add('hidden');
            updateActiveDateButton();
            renderGoals();
        });
        dateButtonsContainer.appendChild(button);
    }
   
    // Add custom date button
    const customButton = document.createElement('button');
    customButton.className = 'date-selector-btn';
    customButton.textContent = 'Other';
    customButton.id = 'custom-date-btn';
    customButton.addEventListener('click', () => {
        goalCustomDateInput.classList.toggle('hidden');
        if(!goalCustomDateInput.classList.contains('hidden')){
            goalCustomDateInput.focus();
        }
    });
    dateButtonsContainer.appendChild(customButton);

    goalCustomDateInput.addEventListener('change', (e) => {
        selectedDate = e.target.value;
        updateActiveDateButton();
        renderGoals();
    });
   
    updateActiveDateButton();
}


function updateActiveDateButton() {
    let isPresetDate = false;
    dateButtonsContainer.querySelectorAll('.date-selector-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.date === selectedDate) {
            btn.classList.add('active');
            isPresetDate = true;
        }
    });
    const customBtn = document.getElementById('custom-date-btn');
    if(!isPresetDate){
       customBtn.classList.add('active');
    } else {
       customBtn.classList.remove('active');
    }
}

// Switch between 'daily' and 'overall' views
function switchView(view) {
    currentView = view;
    goalsViewToggle.querySelectorAll('.goal-toggle-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.view === view) btn.classList.add('active');
    });

    dailyGoalsDateSelector.style.display = view === 'daily' ? 'block' : 'none';
    goalInput.placeholder = view === 'daily' ? `Add a goal for ${getFriendlyDate(selectedDate)}...` : 'Enter an overall goal...';

    renderGoals();
}

// Main render function
function renderGoals() {
    goalsListContainer.innerHTML = '';
    if (currentView === 'daily') {
        renderDailyGoals();
        checkForOldTasks();
    } else {
        renderOverallGoals();
        goalsReminderContainer.innerHTML = '';
    }
    renderClearCompletedButton();
}

function renderDailyGoals() {
    const goalsForSelectedDate = goalsData.daily.filter(g => g.date === selectedDate);
   
    if (goalsForSelectedDate.length === 0) {
        goalsListContainer.innerHTML = `<p class="text-gray-500 text-center">No goals for ${getFriendlyDate(selectedDate)}. Add one!</p>`;
        return;
    }

    goalsForSelectedDate.forEach(goal => {
        const goalElement = createGoalElement(goal);
        goalsListContainer.appendChild(goalElement);
    });
}

function renderOverallGoals() {
    const overallGoals = goalsData.overall || [];
     if (overallGoals.length === 0) {
        goalsListContainer.innerHTML = `<p class="text-gray-500 text-center">No overall goals yet. Add one!</p>`;
        return;
    }
    overallGoals.forEach(goal => {
        const goalElement = createGoalElement(goal);
        goalsListContainer.appendChild(goalElement);
    });
}

// Creates a single goal DOM element
function createGoalElement(goal) {
    const { id, text, completed } = goal;
    const goalItem = document.createElement('div');
    goalItem.className = `goal-item flex items-center justify-between bg-gray-50 p-3 rounded-lg transition hover:bg-gray-100 ${completed ? 'completed' : ''}`;
    const leftSide = document.createElement('div');
    leftSide.className = 'flex items-center';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = completed;
    checkbox.className = 'goal-checkbox h-5 w-5 mr-4 flex-shrink-0';
    checkbox.addEventListener('change', () => toggleGoalCompletion(id));
    const goalText = document.createElement('span');
    goalText.className = 'goal-text text-gray-800';
    goalText.textContent = text;
    leftSide.appendChild(checkbox);
    leftSide.appendChild(goalText);
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'text-red-500 hover:text-red-700';
    deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>`;
    deleteBtn.addEventListener('click', () => deleteGoal(id));
    goalItem.appendChild(leftSide);
    goalItem.appendChild(deleteBtn);
    return goalItem;
}

// --- Data Manipulation Functions ---
function addGoal() {
    const text = goalInput.value.trim();
    if (!text) return;
    const newGoal = { id: Date.now(), text: text, completed: false };
    if (currentView === 'daily') {
        newGoal.date = selectedDate;
        goalsData.daily.push(newGoal);
    } else {
        goalsData.overall.push(newGoal);
    }
    saveAndRerender();
    goalInput.value = '';
}

function deleteGoal(id) {
    if (currentView === 'daily') {
        goalsData.daily = goalsData.daily.filter(g => g.id !== id);
    } else {
        goalsData.overall = goalsData.overall.filter(g => g.id !== id);
    }
    saveAndRerender();
}

function toggleGoalCompletion(id) {
    const list = currentView === 'daily' ? goalsData.daily : goalsData.overall;
    const goal = list.find(g => g.id === id);
    if (goal) goal.completed = !goal.completed;
    saveAndRerender();
}

function saveAndRerender() {
    localStorage.setItem('trainingGoalsV3', JSON.stringify(goalsData));
    renderGoals();
}

// --- Helper & UI Functions ---
function renderClearCompletedButton() {
    const list = currentView === 'daily' ? goalsData.daily.filter(g=>g.date === selectedDate) : goalsData.overall;
    const completedCount = list.filter(g => g.completed).length;

    if (completedCount > 0) {
        clearCompletedContainer.innerHTML = `<button id="clear-completed-btn-dynamic" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition text-sm">Clear ${completedCount} Completed</button>`;
        document.getElementById('clear-completed-btn-dynamic').addEventListener('click', () => {
             if (currentView === 'daily') {
                goalsData.daily = goalsData.daily.filter(g => !g.completed || g.date !== selectedDate);
            } else {
                goalsData.overall = goalsData.overall.filter(g => !g.completed);
            }
            saveAndRerender();
        });
    } else {
        clearCompletedContainer.innerHTML = '';
    }
}

function checkForOldTasks() {
    const todayStr = new Date().toISOString().split('T')[0];
    const oldIncompleteTasks = goalsData.daily.filter(goal => !goal.completed && goal.date < todayStr);
    if (oldIncompleteTasks.length > 0) {
        goalsReminderContainer.innerHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded-md text-sm"><strong>Reminder:</strong> You have ${oldIncompleteTasks.length} incomplete goal(s) from previous days.</div>`;
    } else {
        goalsReminderContainer.innerHTML = '';
    }
}

function getFriendlyDate(dateStr) {
    const today = new Date();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const todayStr_ = today.toISOString().split('T')[0];
    const yesterdayStr_ = yesterday.toISOString().split('T')[0];
    if (todayStr_ === dateStr) return 'Today';
    if (yesterdayStr_ === dateStr) return 'Yesterday';
    const date = new Date(dateStr + 'T00:00:00'); // Ensure correct date parsing
    return date.toLocaleDateString('en-GB', { weekday: 'long', day: '2-digit', month: 'short' });
}

// Make sure this is called inside your main runAppPageScripts function
initGoals();
// --- Video Recording and Analysis Logic (FIXED & SELF-CONTAINED) ---

// Define variables in a scope that functions below can access
let mediaRecorder;
let recordedChunks = [];
let mediaStream;

// This function safely stops all camera tracks.
function stopCamera() {
    if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
    }
}

// This function sets up the entire video recording UI and functionality
function setupVideoRecorder() {
    // Get all necessary elements from the DOM
    const startRecordingBtn = document.getElementById('start-recording-btn');
    const stopRecordingBtn = document.getElementById('stop-recording-btn');
    const uploadBtn = document.getElementById('upload-btn');
    const rerecordBtn = document.getElementById('rerecord-btn');
    const previewControls = document.getElementById('preview-controls');
    const cameraFeed = document.getElementById('camera-feed');
    const videoPreview = document.getElementById('video-preview');
    const recIndicator = document.getElementById('rec-indicator');
    const analysisContainer = document.getElementById('analysis-results-container');
    const analysisLoading = document.getElementById('analysis-loading');
    const analysisResults = document.getElementById('analysis-results');
    const resultReps = document.getElementById('result-reps');
    const resultLevel = document.getElementById('result-level');

    // Resets the UI to the initial 'ready to record' state
    function resetRecorderState() {
        startRecordingBtn.classList.remove('hidden');
        stopRecordingBtn.classList.add('hidden');
        previewControls.classList.add('hidden');
        cameraFeed.classList.remove('hidden');
        videoPreview.classList.add('hidden');
        videoPreview.src = '';
        videoPreview.srcObject = null;
        recIndicator.classList.add('hidden');
        analysisContainer.classList.add('hidden');
        analysisResults.classList.add('hidden');
        analysisLoading.classList.add('hidden');
    }

    // Asks for camera permission and sets up the MediaRecorder
    async function setupCamera() {
        resetRecorderState();
        try {
            mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            cameraFeed.srcObject = mediaStream;
           
            mediaRecorder = new MediaRecorder(mediaStream, { mimeType: 'video/webm' });

            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) recordedChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const videoURL = URL.createObjectURL(blob);
                videoPreview.src = videoURL;

                cameraFeed.classList.add('hidden');
                stopRecordingBtn.classList.add('hidden');
                recIndicator.classList.add('hidden');
                videoPreview.classList.remove('hidden');
                previewControls.classList.remove('hidden');
            };

        } catch (err) {
            console.error("Error accessing camera:", err);
            showMessage("Could not access camera. Please grant permission and ensure one is available.", "error");
        }
    }

    // --- Attach Event Listeners to the Buttons ---
    startRecordingBtn.addEventListener('click', () => {
        recordedChunks = [];
        mediaRecorder.start();
        startRecordingBtn.classList.add('hidden');
        stopRecordingBtn.classList.remove('hidden');
        recIndicator.classList.remove('hidden');
    });

    stopRecordingBtn.addEventListener('click', () => {
        if (mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
        stopCamera();
    });

    rerecordBtn.addEventListener('click', () => {
        setupCamera();
    });

  uploadBtn.addEventListener('click', () => {
        // 1. Validate the Age and Gender fields first
        const ageInput = document.getElementById('test-age');
        const genderInput = document.getElementById('test-gender');
        const isAgeValid = validateField(ageInput, document.getElementById('test-age-error-message'));
        const isGenderValid = validateField(genderInput, document.getElementById('test-gender-error-message'));
        
        if (!isAgeValid || !isGenderValid) {
            showMessage("Please fill in both age and gender before uploading.", "error");
            return; // Stop the function if validation fails
        }
        
        // 2. Show loading state in the UI
        analysisContainer.classList.remove('hidden');
        analysisLoading.classList.remove('hidden');
        analysisResults.classList.add('hidden');
        previewControls.classList.add('hidden');

        // 3. Prepare data for the backend
        const testTitleElement = document.getElementById('test-title');
        const testName = testTitleElement.textContent.trim(); // e.g., "Sit Ups"
        
        // Convert test name to the format your backend expects (e.g., "Sit Ups" -> "situps")
        let testTypeBackend = '';
        if (testName === 'Sit Ups') testTypeBackend = 'situps';
        else if (testName === 'Push Ups') testTypeBackend = 'pushups';
        else if (testName === 'Vertical Height Jump') testTypeBackend = 'vertical_jump';
        else if (testName === 'Sit and Reach Test') testTypeBackend = 'sit_and_reach';
        
        const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
        const formData = new FormData();
        formData.append('video', videoBlob, 'recording.webm');
        formData.append('test_type', testTypeBackend);
        formData.append('age', ageInput.value);
        formData.append('gender', genderInput.value);

        // 4. Send the data to your Flask backend using fetch
        fetch('/analyze', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                // If the server response is not OK, get the error message
                return response.json().then(err => { throw new Error(err.error || 'Server error'); });
            }
            return response.json();
        })
        .then(data => {
            console.log('Success:', data);
            analysisLoading.classList.add('hidden');

            // 5. Update the UI with the actual results from the backend
            resultReps.textContent = data.score || 'N/A';
            resultLevel.textContent = data.level || 'N/A';
            document.getElementById('result-date-time').textContent = `Analyzed on: ${new Date().toLocaleString()}`;
            
            analysisResults.classList.remove('hidden');
        })
        .catch((error) => {
            console.error('Error:', error);
            analysisLoading.classList.add('hidden');
            showMessage(`Analysis failed: ${error.message}`, 'error');
            // Show the re-record button again on failure
            previewControls.classList.remove('hidden'); 
        });
    });
    // This is the first thing that happens when the recorder is set up
    setupCamera();
}

// This NEW function correctly handles opening the test modal AND starting the camera
function handleTestCardClick(e) {
    const testName = e.currentTarget.getAttribute("data-test-name");
    testTitle.textContent = testName;
    mainContent.classList.add("hidden");
    animatedBackground.classList.add("hidden");
   
    showModal(testDetailModal);
    setupVideoRecorder(); // This correctly sets up the video recorder every time a card is clicked

    // Reset tabs to show the 'Evaluation' tab by default
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove("border-orange-600", "text-orange-600");
        btn.classList.add("border-transparent", "text-gray-500");
    });
    document.querySelectorAll('.tab-content').forEach(content => content.classList.add("hidden"));
   
    const evaluationTabButton = document.querySelector('.tab-btn[data-tab-name="evaluation"]');
    const evaluationTabContent = document.getElementById("evaluation-tab-content");

    if (evaluationTabButton && evaluationTabContent) {
        evaluationTabButton.classList.add("border-orange-600", "text-orange-600");
        evaluationTabContent.classList.remove("hidden");
    }
   
    loadLeaderboard("country");
}

// Attach the new, correct event listener to all test cards
document.querySelectorAll('.test-card').forEach(card => card.addEventListener("click", handleTestCardClick));

// Correctly handle closing the modal to ensure the camera ALWAYS stops
closeTestModal.addEventListener("click", () => {
    hideModal(testDetailModal);
    mainContent.classList.remove("hidden");
    animatedBackground.classList.remove("hidden");
    stopCamera(); // This is crucial
});

backFromTestDetailsBtn.addEventListener("click", () => {
    hideModal(testDetailModal);
    mainContent.classList.remove("hidden");
    animatedBackground.classList.remove("hidden");
    stopCamera(); // This is crucial
});


           

           
            // Game-specific tests modal logic
            gameTestIcons.forEach(icon => {
                icon.addEventListener('click', (e) => {
                    const sportName = e.currentTarget.dataset.sportName;
                    const sportDetails = gameSpecificTestDetails[sportName];
                    gameTestTitle.textContent = sportDetails.name;
                   
                    renderGameTests(sportDetails.tests, sportName);
                   
                    mainContent.classList.add("hidden");
                    animatedBackground.classList.add("hidden");
                    showModal(gameTestModal);
                });
            });

            closeGameTestModal.addEventListener('click', () => {
                hideModal(gameTestModal);
                mainContent.classList.remove('hidden');
                animatedBackground.classList.remove('hidden');
            });

            function renderGameTests(tests, sportName) {
                let html = '';
                tests.forEach(test => {
                    html += `
                        <div class="test-card-game bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer" data-test-name="${test.name}" data-sport-name="${sportName}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 20v-8M9 15l3-3 3 3M12 4l-4 4h8l-4-4z"/>
                            </svg>
                            <h3 class="font-semibold text-lg text-gray-900 mb-2">${test.name}</h3>
                            <p class="text-sm text-gray-500">${test.description}</p>
                        </div>
                    `;
                });
                gameTestsListContainer.innerHTML = html;
                gameTestLeaderboardContainer.classList.add('hidden'); // Hide leaderboard initially

                // Add event listeners to the new game test cards
                document.querySelectorAll('.test-card-game').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const testName = e.currentTarget.dataset.testName;
                        const sportName = e.currentTarget.dataset.sportName;
                        const leaderboard = gameSpecificTestDetails[sportName].leaderboards[testName];
                       
                        renderGameLeaderboard(testName, leaderboard);
                    });
                });
            }

            function renderGameLeaderboard(testName, data) {
                testLeaderboardTitle.textContent = `Leaderboard: ${testName}`;
                let html = '';
                data.forEach(user => {
                    html += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.rank}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${user.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.score}</td>
                        </tr>
                    `;
                });
                gameLeaderboardBody.innerHTML = html;
                gameTestLeaderboardContainer.classList.remove('hidden'); // Show leaderboard
            }

            tabButtons.forEach((button) => {
                button.addEventListener("click", (e) => {
                    const tabName = e.target.getAttribute("data-tab-name");
                   
                    tabButtons.forEach((btn) => {
                        btn.classList.remove("border-orange-600", "text-orange-600");
                        btn.classList.add("border-transparent", "text-gray-500");
                    });
                   
                    tabContents.forEach((content) => content.classList.add("hidden"));
                   
                    e.target.classList.remove("border-transparent", "text-gray-500");
                    e.target.classList.add("border-orange-600", "text-orange-600");
                   
                    document.getElementById(`${tabName}-tab-content`).classList.remove("hidden");
                   
                    // If history tab is clicked, render graph and table
                    if (tabName === 'history') {
                        const currentTestName = document.getElementById('test-title').textContent;
                        renderScoreHistoryGraph(currentTestName, 'week'); // Default to week view
                        populateHistoryTable(currentTestName);
                        // Make sure the week button is active
                         document.querySelectorAll('#graph-filters .graph-filter-btn').forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.dataset.duration === 'week') {
                                btn.classList.add('active');
                            }
                        });
                    }
                });
            });

           
            aiCoachBtn.addEventListener('click', async () => {
                if (!lastEvaluationResults) {
                    showMessage("Please submit an evaluation or select a score from history first.", "info");
                    return;
                }

                const { testName, score, jumpHeight, cheatProbability, benchmark, status, comments } = lastEvaluationResults;
                const age = profileAge.textContent.replace(' Age', '');
                const height = profileHeight.textContent.replace(' cm', '');
                const weight = profileWeight.textContent.replace(' kg', '');

                aiLoading.classList.remove('hidden');
                aiFeedbackContainer.classList.add('hidden');
                aiCoachBtn.disabled = true;

                const userQuery = `I am a ${age} year old athlete, ${height}cm tall, weighing ${weight}kg. I recently took a sports talent assessment test called "${testName}". My score was "${score}". My jump height was ${jumpHeight}, my cheat probability was ${cheatProbability}, and the benchmark is ${benchmark}. The evaluator left this comment: "${comments}". Provide me with a concise, single-paragraph summary of my performance and offer one or two specific, actionable tips to improve, focusing on technique and form.`;
                const apiKey = ""
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: "Act as a highly experienced sports coach and performance analyst. Your tone should be encouraging, professional, and insightful." }]
                    },
                };

                let response;
                let retries = 0;
                const maxRetries = 3;
                let delay = 1000;

                while (retries < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            break; // Success, exit the loop
                        } else if (response.status === 429) {
                            // Too Many Requests, implement exponential backoff
                            console.log(`Rate limit exceeded. Retrying in ${delay / 1000} seconds...`);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2; // Double the delay for the next retry
                            retries++;
                        } else {
                            // Other errors, throw to be caught below
                            response.json().then(error => console.error('API Error:', error)).catch(() => console.error('API Error:', response.statusText));
                            throw new Error('API call failed');
                        }
                    } catch (error) {
                        console.error('Fetch Error:', error);
                        retries++;
                        if (retries === maxRetries) {
                            aiFeedbackText.textContent = 'Sorry, I couldn\'t generate feedback right now. Please try again later.';
                            aiFeedbackContainer.classList.remove('hidden');
                            aiLoading.classList.add('hidden');
                            aiCoachBtn.disabled = false;
                            return;
                        }
                    }
                }
               
                if (response && response.ok) {
                    const result = await response.json();
                    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate feedback right now.";
                    aiFeedbackText.textContent = text;
                    aiFeedbackContainer.classList.remove('hidden');
                } else {
                    aiFeedbackText.textContent = 'Sorry, I couldn\'t generate feedback right now. Please try again later.';
                    aiFeedbackContainer.classList.remove('hidden');
                }
               
                aiLoading.classList.add('hidden');
                aiCoachBtn.disabled = false;
            });

            document.getElementById("filter-country").addEventListener("click", () => loadLeaderboard("country"));
            document.getElementById("filter-state").addEventListener("click", () => loadLeaderboard("state"));
            document.getElementById("filter-district").addEventListener("click", () => loadLeaderboard("district"));

            function loadLeaderboard(filter) {
                const data = leaderboardData[filter];
                let html = "";
                data.forEach((item) => {
                    html += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.rank}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.score}</td>
                        </tr>
                    `;
                });
                leaderboardBody.innerHTML = html;
            }

            function renderMainLeaderboard(data) {
                const tableBody = document.getElementById("main-leaderboard-body");
                const cardsContainer = document.getElementById("main-leaderboard-cards");
                if (!tableBody || !cardsContainer) return;

                tableBody.innerHTML = "";
                cardsContainer.innerHTML = "";

                data.forEach(user => {
                    // Create Table Row (for desktop)
                    const row = document.createElement("tr");
                    row.innerHTML = `<td class="px-6 py-4 text-sm leaderboard-rank">${user.rank}</td><td class="px-6 py-4 text-sm text-gray-700">${user.name}</td><td class="px-6 py-4 text-sm text-gray-500">${user.address}</td><td class="px-6 py-4 text-sm text-gray-500">${user.state}</td><td class="px-6 py-4 text-sm"><span class="${user.verified ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full text-xs font-semibold">${user.verified ? "✅ Verified" : "❌ Not Verified"}</span></td><td class="px-6 py-4 text-sm text-gray-600">${Object.entries(user.tests).map(([test, result]) => `${test}: ${result}`).join("<br>")}</td><td class="px-6 py-4 text-sm leaderboard-highlight">🏅 ${user.recordHighlight}</td>`;
                    tableBody.appendChild(row);

                    // Create Card (for mobile)
                    const card = document.createElement("div");
                    card.className = "p-4 border-b border-gray-200";
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold text-lg text-gray-800">${user.name}</p>
                                <p class="text-sm text-gray-500">${user.address}</p>
                            </div>
                            <div class="text-right flex-shrink-0 ml-4">
                                <p class="text-2xl font-bold leaderboard-rank">${user.rank}</p>
                                <span class="${user.verified ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 mt-1 inline-block rounded-full text-xs font-semibold">${user.verified ? "✅ Verified" : "❌ Not Verified"}</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="font-semibold text-gray-700 text-sm">Fitness Tests:</p>
                            <p class="text-sm text-gray-600">${Object.entries(user.tests).map(([test, result]) => `${test}: <strong>${result}</strong>`).join("<br>")}</p>
                        </div>
                        <div class="mt-2">
                            <p class="font-semibold text-gray-700 text-sm">Record Highlight:</p>
                            <p class="text-sm leaderboard-highlight inline-block p-1 rounded">🏅 ${user.recordHighlight}</p>
                        </div>
                    `;
                    cardsContainer.appendChild(card);
                });
            }

            function applyMainLeaderboardFilters() {
                const searchValue = document.getElementById("leaderboard-search")?.value.toLowerCase() || "";
                const filterValue = document.getElementById("leaderboard-filter")?.value || "all";
                let filteredData = mainLeaderboardData.filter(user => {
                    const matchesSearch = user.name.toLowerCase().includes(searchValue) || user.address.toLowerCase().includes(searchValue) || user.state.toLowerCase().includes(searchValue) || Object.keys(user.tests).some(test => test.toLowerCase().includes(searchValue));
                    let matchesFilter = true;
                    if (filterValue === "verified") matchesFilter = user.verified;
                    if (filterValue === "not-verified") matchesFilter = !user.verified;
                    if (filterValue !== "all" && filterValue !== "verified" && filterValue !== "not-verified") {
                        matchesFilter = user.state === filterValue;
                    }
                    return matchesSearch && matchesFilter;
                });
                renderMainLeaderboard(filteredData);
            }

            renderMainLeaderboard(mainLeaderboardData);
           
            const leaderboardSearch = document.getElementById("leaderboard-search");
            if(leaderboardSearch) leaderboardSearch.addEventListener("input", applyMainLeaderboardFilters);
           
            const leaderboardFilter = document.getElementById("leaderboard-filter");
            if(leaderboardFilter) leaderboardFilter.addEventListener("change", applyMainLeaderboardFilters);
           
            // New profile modal logic
            const dummyProfileData = {
                name: "Virat Kohli",
                age: 35,
                gender: "Male",
                height: 175, // in cm
                weight: 75, // in kg
                level: "Pro Athlete"
            };

            function calculateBMI(height, weight) {
                const heightInMeters = height / 100;
                return (weight / (heightInMeters * heightInMeters)).toFixed(1);
            }

            function updateProfileModal() {
                profileName.textContent = dummyProfileData.name;
                profileAge.textContent = dummyProfileData.age;
                profileGender.textContent = dummyProfileData.gender;
                profileHeight.textContent = `${dummyProfileData.height} cm`;
                profileWeight.textContent = `${dummyProfileData.weight} kg`;
                profileBMI.textContent = calculateBMI(dummyProfileData.height, dummyProfileData.weight);
                profileLevel.textContent = dummyProfileData.level;
            }

            // Bind profile button clicks to open the modal
            document.getElementById('profile-menu-button-app').addEventListener('click', updateProfileModal);
           
            const profileMenuButton = document.getElementById('profile-menu-button');
            if (profileMenuButton) {
                profileMenuButton.addEventListener('click', updateProfileModal);
            }

            logoutBtn.addEventListener('click', () => {
                hideModal(profileModal);
                showModal(loginModal); // Simulates logging out and going to login
            });

            // New event listener for the overall performance analysis button
            analyzePerformanceBtn.addEventListener('click', () => {
                renderPerformanceRadarChart();
                showModal(performanceAnalysisModal);
            });
   
            closeAnalysisModalBtn.addEventListener('click', () => {
                hideModal(performanceAnalysisModal);
            });
        }
       
        // --- SCORE HISTORY GRAPH AND TABLE ---
        function renderScoreHistoryGraph(testName, duration) {
            const data = scoreHistoryData[testName] || [];
            const now = new Date();
            let filteredData = [];

            if (duration === 'week') {
                const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredData = data.filter(d => new Date(d.date) >= sevenDaysAgo);
            } else if (duration === 'month') {
                const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredData = data.filter(d => new Date(d.date) >= thirtyDaysAgo);
            } else {
                filteredData = data;
            }

            const ctx = document.getElementById('scoreHistoryChart').getContext('2d');
            const labels = filteredData.map(d => new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            const scores = filteredData.map(d => d.score);

            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Score for ${testName}`,
                        data: scores,
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(251, 146, 60, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#f97316',
                        pointHoverBackgroundColor: '#f97316',
                        pointHoverBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#e5e7eb'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
       
        function populateHistoryTable(testName) {
            const tableBody = document.getElementById('history-table-body');
            const data = scoreHistoryData[testName] || [];
            tableBody.innerHTML = ''; // Clear existing rows

            // Sort data descending by date
            const sortedData = data.sort((a, b) => new Date(b.date) - new Date(a.date));

            if(sortedData.length === 0) {
                 tableBody.innerHTML = `<tr><td colspan="3" class="text-center py-4 text-gray-500">No history found for this test.</td></tr>`;
                 return;
            }

            sortedData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'history-row hover:bg-gray-50 cursor-pointer';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${new Date(item.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.score}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-orange-600 hover:text-orange-900">View</button>
                    </td>
                `;
                row.addEventListener('click', () => {
                    const testName = document.getElementById("test-title").textContent;
                   
                    lastEvaluationResults = {
                        testName: testName,
                        score: item.score,
                        comments: item.comments,
                        videoUrl: item.videoUrl,
                        // Dummy data for now, would come from `item` in a real app
                        jumpHeight: 'N/A',
                        cheatProbability: 'Low',
                        benchmark: 'N/A',
                        status: '✅ Verified'
                    };

                    document.getElementById('history-detail-title').textContent = `Evaluation for ${new Date(item.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}`;
                    historyVideoPlayer.src = item.videoUrl;
                    evaluatorComments.textContent = item.comments;

                    // This part can be enhanced with real data if available
                    jumpHeightSpan.textContent = lastEvaluationResults.jumpHeight;
                    cheatProbSpan.textContent = lastEvaluationResults.cheatProbability;
                    benchmarkSpan.textContent = lastEvaluationResults.benchmark;
                    verifiedSpan.textContent = lastEvaluationResults.status;
                    resultsDisplay.classList.remove('hidden');

                    aiFeedbackText.textContent = "";
                    aiFeedbackContainer.classList.add('hidden');

                    renderPerformanceComparisonRadar();
                    showModal(scoreHistoryModal);
                });
                tableBody.appendChild(row);
            });
        }
       
        function renderPerformanceComparisonRadar() {
            const ctx = document.getElementById('performanceComparisonChart').getContext('2d');
            const labels = Object.keys(userPerformanceData);
            const userData = Object.values(userPerformanceData);
            const benchmarkData = Object.values(nationalBenchmarkData);
       
            if (performanceComparisonChart) {
                performanceComparisonChart.destroy();
            }
       
            performanceComparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Your Performance',
                        data: userData,
                        fill: true,
                        backgroundColor: 'rgba(251, 146, 60, 0.2)',
                        borderColor: 'rgb(251, 146, 60)',
                        pointBackgroundColor: 'rgb(251, 146, 60)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(251, 146, 60)'
                    }, {
                        label: 'National Benchmark',
                        data: benchmarkData,
                        fill: true,
                        backgroundColor: 'rgba(15, 76, 117, 0.2)',
                        borderColor: 'rgb(15, 76, 117)',
                        pointBackgroundColor: 'rgb(15, 76, 117)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(15, 76, 117)'
                    }]
                },
                options: {
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#e5e7eb' },
                            grid: { color: '#e5e7eb' },
                            pointLabels: {
                                font: { size: 12, weight: 'bold' },
                                color: '#374151'
                            },
                            ticks: {
                                backdropColor: 'rgba(255, 255, 255, 0.75)',
                                color: '#6b7280',
                                stepSize: 20
                            },
                            min: 0,
                            max: 100
                        }
                    },
                     plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function renderPerformanceRadarChart() {
            const ctx = document.getElementById('performanceRadarChart').getContext('2d');
            const labels = Object.keys(userPerformanceData);
            const userData = Object.values(userPerformanceData);
            const benchmarkData = Object.values(nationalBenchmarkData);
       
            if (overallPerformanceChart) {
                overallPerformanceChart.destroy();
            }
       
            overallPerformanceChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Your Performance',
                        data: userData,
                        fill: true,
                        backgroundColor: 'rgba(251, 146, 60, 0.2)',
                        borderColor: 'rgb(251, 146, 60)',
                        pointBackgroundColor: 'rgb(251, 146, 60)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(251, 146, 60)'
                    }, {
                        label: 'National Benchmark',
                        data: benchmarkData,
                        fill: true,
                        backgroundColor: 'rgba(15, 76, 117, 0.2)',
                        borderColor: 'rgb(15, 76, 117)',
                        pointBackgroundColor: 'rgb(15, 76, 117)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(15, 76, 117)'
                    }]
                },
                options: {
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#e5e7eb' },
                            grid: { color: '#e5e7eb' },
                            pointLabels: {
                                font: { size: 12, weight: 'bold' },
                                color: '#374151'
                            },
                            ticks: {
                                backdropColor: 'rgba(255, 255, 255, 0.75)',
                                color: '#6b7280',
                                stepSize: 20
                            },
                            min: 0,
                            max: 100
                        }
                    },
                     plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        document.getElementById('graph-filters').addEventListener('click', (e) => {
            if (e.target.classList.contains('graph-filter-btn')) {
                const duration = e.target.dataset.duration;
                const currentTestName = document.getElementById('test-title').textContent;
               
                document.querySelectorAll('#graph-filters .graph-filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
               
                renderScoreHistoryGraph(currentTestName, duration);
            }
        });

        // New event listener for the overall performance analysis button
        analyzePerformanceBtn.addEventListener('click', () => {
            renderPerformanceRadarChart();
            showModal(performanceAnalysisModal);
        });

        closeAnalysisModalBtn.addEventListener('click', () => {
            hideModal(performanceAnalysisModal);
        });


        // New functions for event and sport details
        function openEventDetailsModal(eventKey) {
            currentMajorEvent = eventKey; // Store the current event
            const eventData = majorEventsData[eventKey];
            eventDetailsTitle.textContent = eventData.name;
           
            // Populate description, level, and facts
            document.getElementById('event-description-text').textContent = eventData.description;
            document.getElementById('event-level-badge').innerHTML = `<span class="px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">${eventData.level}</span>`;
            const factsList = document.getElementById('event-facts-list');
            factsList.innerHTML = '';
            eventData.facts.forEach(fact => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-orange-500 mr-2 mt-1 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <span>${fact}</span>`;
                factsList.appendChild(li);
            });

            sportsGrid.innerHTML = ''; // Clear previous content
            Object.keys(eventData.sports).forEach(sportKey => {
                const sport = eventData.sports[sportKey];
                const sportCard = document.createElement('div');
                sportCard.className = 'test-card bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer h-full';
                sportCard.dataset.sportKey = sportKey;
                sportCard.innerHTML = `
                    <h3 class="font-semibold text-xl text-gray-900 mb-2">${sport.name}</h3>
                    <p class="text-sm text-gray-500 flex-grow">${sport.description}</p>
                `;
                sportCard.addEventListener('click', () => {
                    openSportDetailsModal(eventKey, sportKey);
                });
                sportsGrid.appendChild(sportCard);
            });
            showModal(eventDetailsModal);
        }

        function openSportDetailsModal(eventKey, sportKey) {
            const sportData = majorEventsData[eventKey].sports[sportKey];
            sportDetailsTitle.textContent = sportData.name;
            sportDetailsDescription.textContent = sportData.description;

            // Populate parameters
            sportParametersList.innerHTML = sportData.parameters.map(param => `
                <li class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                    <span>${param}</span>
                </li>
            `).join('');

            // Populate records
            sportRecordsContainer.innerHTML = `
                <h4 class="text-md font-semibold text-gray-700 mb-2">🏆 Top Tier Records</h4>
                ${sportData.records.top.map(record => `
                    <div class="bg-white p-4 rounded-lg shadow mb-3">
                        <p class="font-bold text-orange-600">${record.benchmark}</p>
                        <p class="font-semibold text-gray-800 text-sm">Target: ${record.athlete}</p>
                        <p class="text-sm text-gray-600 mt-1">${record.details}</p>
                    </div>
                `).join('')}

                <h4 class="text-md font-semibold text-gray-700 mt-6 mb-2">📈 Average National Benchmarks</h4>
                ${sportData.records.average.map(record => `
                    <div class="bg-white p-4 rounded-lg shadow mb-3">
                        <p class="font-bold text-blue-600">${record.benchmark}</p>
                        <p class="font-semibold text-gray-800 text-sm">Target: ${record.athlete}</p>
                        <p class="text-sm text-gray-600 mt-1">${record.details}</p>
                    </div>
                `).join('')}
            `;
           
            hideModal(eventDetailsModal);
            showModal(sportDetailsModal);
        }

        closeEventDetailsModalBtn.addEventListener('click', () => hideModal(eventDetailsModal));
        closeSportDetailsModalBtn.addEventListener('click', () => hideModal(sportDetailsModal));
        backFromHistoryBtn.addEventListener('click', () => hideModal(scoreHistoryModal));
        backToEventDetailsBtn.addEventListener('click', () => {
            hideModal(sportDetailsModal);
            if (currentMajorEvent) {
                openEventDetailsModal(currentMajorEvent);
            }
        });

    </script>

    <!-- chatbot started -->
    <!-- Chatbot FAB -->
<button id="chat-fab" class="fixed bottom-6 right-6 bg-orange-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center z-50">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
    </svg>
</button>

<!-- Chatbot Container -->
<div id="chat-container" class="fixed bottom-24 right-6 w-full max-w-sm h-3/5 max-h-[500px] bg-white rounded-2xl shadow-2xl flex flex-col z-50">
    <!-- Header -->
    <div class="bg-orange-600 text-white p-4 rounded-t-2xl flex justify-between items-center">
        <h3 class="font-bold text-lg">SAI Helper Bot</h3>
        <button id="close-chat-btn" class="text-white hover:text-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
    <!-- Messages -->
    <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4">
        <!-- Messages will be injected here by JavaScript -->
    </div>
    <!-- Input -->
    <div class="p-4 border-t border-gray-200">
        <div class="flex items-center space-x-2">
            <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-orange-500">
            <button id="chat-send-btn" class="bg-orange-600 text-white w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                </svg>
            </button>
        </div>
    </div>
</div>

<script>
const chatFab = document.getElementById('chat-fab');
const chatContainer = document.getElementById('chat-container');
const closeChatBtn = document.getElementById('close-chat-btn');
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const chatSendBtn = document.getElementById('chat-send-btn');

// Predefined Q&A pairs for the chatbot
const chatResponses = {
    "how do i start a test": "To start a test, please log in to the app. From the main dashboard, you can select from 'Fitness Assignment Tests' or 'Game-specific Fitness Tests'. Just click on the test you want to take!",
    "upload video": "After selecting a test, go to the 'Evaluation' tab. There you will find instructions and a button to upload your performance video.",
    "see my score": "You can view your past scores in two places! Go to the test details page and click on the 'Score History' tab. You can also see your overall performance on the main leaderboard on the app's home page.",
    "what tests are available": "We have general fitness tests like Sit Ups, Push Ups, Vertical Jumps, and Sit and Reach. We also have game-specific tests for Football, Cricket, Hockey, Badminton, and Athletics.",
    "leaderboard": "The leaderboard shows your ranking compared to other athletes. You can view leaderboards for each specific test, as well as an overall leaderboard on the main app page.",
    "help": "I can help with questions about starting a test, uploading videos, and checking your scores. What would you like to know?",
    "default": "I'm not sure how to answer that. You can ask me things like 'how do I start a test?' or 'how do I see my score?'."
};

// Function to toggle the chat window
const toggleChat = () => {
    chatContainer.classList.toggle('active');
};

if (chatFab) {
    chatFab.addEventListener('click', toggleChat);
}
if(closeChatBtn) {
    closeChatBtn.addEventListener('click', toggleChat);
}


// Function to add a message to the chat window
function addMessage(sender, message) {
    const messageElement = document.createElement('div');
    messageElement.className = `w-fit max-w-xs lg:max-w-md p-3 rounded-2xl ${sender === 'user' ? 'user-message self-end' : 'bot-message self-start'}`;
    messageElement.textContent = message;
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to the latest message
}

// Function to simulate bot typing and get a response
function getBotResponse(userMessage) {
    const lowerCaseMessage = userMessage.toLowerCase();
    let botReply = chatResponses.default;

    // Simple keyword matching
    if (lowerCaseMessage.includes("start") && lowerCaseMessage.includes("test")) {
        botReply = chatResponses["how do i start a test"];
    } else if (lowerCaseMessage.includes("upload") || lowerCaseMessage.includes("video")) {
        botReply = chatResponses["upload video"];
    } else if (lowerCaseMessage.includes("score") || lowerCaseMessage.includes("history") || lowerCaseMessage.includes("result")) {
        botReply = chatResponses["see my score"];
    } else if (lowerCaseMessage.includes("what tests") || lowerCaseMessage.includes("available tests")) {
        botReply = chatResponses["what tests are available"];
    } else if (lowerCaseMessage.includes("leaderboard") || lowerCaseMessage.includes("rank")) {
        botReply = chatResponses["leaderboard"];
    } else if (lowerCaseMessage.includes("help")) {
        botReply = chatResponses["help"];
    }

    // Add a typing indicator
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'bot-message self-start p-3 rounded-2xl typing-indicator';
    chatMessages.appendChild(typingIndicator);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Simulate delay for bot "thinking"
    setTimeout(() => {
        if(chatMessages.contains(typingIndicator)){
            chatMessages.removeChild(typingIndicator); // Remove typing indicator
        }
        addMessage('bot', botReply);
    }, 1500);
}

// Function to handle sending a message
function sendMessage() {
    const message = chatInput.value.trim();
    if (message) {
        addMessage('user', message);
        getBotResponse(message);
        chatInput.value = '';
    }
}

if(chatSendBtn) {
    chatSendBtn.addEventListener('click', sendMessage);
}

if(chatInput) {
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
}


// Initial greeting from the bot
setTimeout(() => {
    if(chatContainer && chatContainer.classList.contains('active')){
         addMessage('bot', 'Hello! How can I help you navigate the SAI platform today?');
    }
}, 500);
</script>





</body>
</html>